"use strict";(self.webpackChunkspark=self.webpackChunkspark||[]).push([[284,675,678,787],{20053:(b,C,e)=>{e.r(C),e.d(C,{default:()=>A});function n(E){var c,P,d="";if(typeof E=="string"||typeof E=="number")d+=E;else if(typeof E=="object")if(Array.isArray(E))for(c=0;c<E.length;c++)E[c]&&(P=n(E[c]))&&(d&&(d+=" "),d+=P);else for(c in E)E[c]&&(d&&(d+=" "),d+=c);return d}function A(){for(var E=0,c,P,d="";E<arguments.length;)(c=arguments[E++])&&(P=n(c))&&(d&&(d+=" "),d+=P);return d}},34383:(b,C,e)=>{e.d(C,{A:()=>d});var n=e(31601),A=e.n(n),E=e(76314),c=e.n(E),P=c()(A());P.push([b.id,`a{user-select:none}.ant-table-body{max-height:300px;min-height:300px}.ant-breadcrumb{overflow-x:hidden;white-space:nowrap}.ant-pro-table-list-toolbar{overflow:hidden;-ms-overflow-style:none;scrollbar-width:none}.ant-pro-table-list-toolbar::-webkit-scrollbar{display:none}.editor-modal,.editor-modal>.ant-modal-content{top:0;margin:0;padding:0;height:100%;width:100%!important;max-width:100%!important}.editor-modal>.ant-modal-content>.ant-modal-body{height:calc(100% - 110px)}.file-row{user-select:none;cursor:pointer}
`,""]);const d=P},37848:(b,C,e)=>{e.d(C,{default:()=>X});var n=e(68275),A=e(96540),E=e(55794),c=e.n(E),P=Object.defineProperty,d=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,W=(l,u,_)=>u in l?P(l,u,{enumerable:!0,configurable:!0,writable:!0,value:_}):l[u]=_,v=(l,u)=>{for(var _ in u||(u={}))L.call(u,_)&&W(l,_,u[_]);if(d)for(var _ of d(u))B.call(u,_)&&W(l,_,u[_]);return l};function R(l){const[u,_]=(0,A.useState)(!0),[O,F]=(0,A.useState)({left:0,top:0,bottom:0,right:0}),I=(0,A.useRef)(null),j=(x,y)=>{var D;const{clientWidth:G,clientHeight:N}=window.document.documentElement,U=(D=I.current)==null?void 0:D.getBoundingClientRect();!U||u||F({left:-U.left+y.x,right:G-(U.right-y.x),top:-U.top+y.y,bottom:N-(U.bottom-y.y)})};return A.createElement(n.A,v({title:A.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{u&&l.draggable&&_(!1)},onMouseOut:()=>{_(!0)},onFocus:()=>{},onBlur:()=>{_(!0)}},l.modalTitle),modalRender:x=>A.createElement(c(),{disabled:u||!l.draggable,bounds:O,onStart:(y,D)=>j(y,D)},A.createElement("div",{ref:I},x))},l),l.children)}const X=R},43678:(b,C,e)=>{e.d(C,{default:()=>O});var n=e(85072),A=e.n(n),E=e(97825),c=e.n(E),P=e(77659),d=e.n(P),L=e(55056),B=e.n(L),W=e(10540),v=e.n(W),R=e(41113),X=e.n(R),l=e(34383),u={};u.styleTagTransform=X(),u.setAttributes=B(),u.insert=d().bind(null,"head"),u.domAPI=c(),u.insertStyleElement=v();var _=A()(l.A,u);const O=l.A&&l.A.locals?l.A.locals:void 0},54055:(b,C,e)=>{e.d(C,{default:()=>_});var n=e(96540),A=e(55373),E=e.n(A),c=e(75427),P=e(72505),d=e.n(P),L=e(79478),B=e(68275),W=e(57427),v=e(26493),R=e(47730),X=e(37848);let l=null;function u(O){const[F,I]=(0,n.useState)(!!O.file),[j,x]=(0,n.useState)(0),[y,D]=(0,n.useState)(0);(0,n.useEffect)(()=>{D(0),O.file&&(I(!0),x(0))},[O.file]);function G(){if(y!==0){N();return}const ee=E().stringify({device:O.device.id,path:O.path,file:O.file.name});let K=1;D(1),window.onbeforeunload=c.V3,l=new AbortController,d().post("/api/device/file/upload?"+ee,O.file,{headers:{"Content-Type":"application/octet-stream"},timeout:0,onUploadProgress:S=>{let te=Math.round(S.loaded*100/S.total);x(te)},signal:l.signal}).then(S=>{S.data.code===0?(K=2,D(2),L.Ay.success(R.Ay.t("EXPLORER.UPLOAD_SUCCESS"))):(K=3,D(3))}).catch(S=>{d().isCancel(S)?(K=4,D(4),L.Ay.error(R.Ay.t("EXPLORER.UPLOAD_ABORTED"))):(K=3,D(3),L.Ay.error(R.Ay.t("EXPLORER.UPLOAD_FAILED")+R.Ay.t("COMMON.COLON")+S.message))}).finally(()=>{l=null,window.onbeforeunload=null,setTimeout(()=>{I(!1),K===2?O.onSuccess():O.onCancel()},1500)})}function N(){if(y===0){I(!1),setTimeout(O.onCancel,300);return}if(y===1){B.A.confirm({autoFocusButton:"cancel",content:R.Ay.t("EXPLORER.UPLOAD_CANCEL_CONFIRM"),onOk:()=>{l.abort()},okButtonProps:{danger:!0}});return}setTimeout(()=>{I(!1),setTimeout(O.onCancel,300)},1500)}function U(){switch(y){case 1:return j+"%";case 2:return R.Ay.t("EXPLORER.UPLOAD_SUCCESS");case 3:return R.Ay.t("EXPLORER.UPLOAD_FAILED");case 4:return R.Ay.t("EXPLORER.UPLOAD_ABORTED");default:return R.Ay.t("EXPLORER.UPLOAD")}}return n.createElement(X.default,{centered:!0,draggable:!0,open:F,closable:!1,keyboard:!1,maskClosable:!1,destroyOnClose:!0,confirmLoading:y===1,okText:R.Ay.t(y===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),modalTitle:R.Ay.t(y===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),okButtonProps:{disabled:y!==0},cancelButtonProps:{disabled:y>1},onCancel:N,onOk:G,width:550},n.createElement("div",null,n.createElement("span",{style:{whiteSpace:"nowrap",fontSize:"20px",marginRight:"10px"}},U()),n.createElement(v.A.Text,{ellipsis:{rows:1},style:{maxWidth:"calc(100% - 140px)"}},O.file.name),n.createElement("span",{style:{whiteSpace:"nowrap"}},"\uFF08"+(0,c.Xq)(O.file.size)+"\uFF09")),n.createElement(W.A,{strokeLinecap:"butt",percent:j,showInfo:!1}))}const _=u},80503:(b,C,e)=>{e.d(C,{default:()=>he});var n=e(96540),A=e(25955),E=e(95005),c=e(40570),P=e(21086),d=e(68275),L=e(79478),B=e(50400),W=e(86348),v=e(75427),R=e(74353),X=e.n(R),l=e(47730),u=e(31331),_=e(21348),O=e(80581),F=e(89379),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const j=I;var x=e(59114),y=function(a,s){return n.createElement(x.A,(0,F.A)((0,F.A)({},a),{},{ref:s,icon:j}))};y.displayName="UploadOutlined";const D=n.forwardRef(y);var G=e(55373),N=e.n(G),U=e(37848),ee=e(54055),K=e(80952),S=e.n(K),te=e(43678),me=Object.defineProperty,ae=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,oe=(r,a,s)=>a in r?me(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s,ye=(r,a)=>{for(var s in a||(a={}))_e.call(a,s)&&oe(r,s,a[s]);if(ae)for(var s of ae(a))Oe.call(a,s)&&oe(r,s,a[s]);return r},Ae=(r,a,s)=>new Promise((p,g)=>{var m=T=>{try{Q(s.next(T))}catch(z){g(z)}},h=T=>{try{Q(s.throw(T))}catch(z){g(z)}},Q=T=>T.done?p(T.value):Promise.resolve(T.value).then(m,h);Q((s=s.apply(r,a)).next())});let k=null;const Pe=S().require("ace/ext/modelist");function Re(r){k===null?Promise.all([e.e(470),e.e(258),e.e(95),e.e(719)]).then(e.bind(e,79100)).then(a=>{k=a.default,r()}):r()}let M=!1,w="",V=[];function ve(r){const[a,s]=(0,n.useState)("/"),[p,g]=(0,n.useState)(""),[m,h]=(0,n.useState)(!1),[Q,T]=(0,n.useState)(!0),[z,q]=(0,n.useState)(!1),[se,re]=(0,n.useState)(""),[ge,ie]=(0,n.useState)(""),[Z,de]=(0,n.useState)([]),Le=[{key:"Name",title:l.Ay.t("EXPLORER.FILE_NAME"),dataIndex:"name",ellipsis:!0,width:180},{key:"Size",title:l.Ay.t("EXPLORER.FILE_SIZE"),dataIndex:"size",ellipsis:!0,width:60,renderText:(t,o)=>o.type===0||o.type===2?(0,v.Xq)(t):"-"},{key:"Time",title:l.Ay.t("EXPLORER.DATE_MODIFIED"),dataIndex:"time",ellipsis:!0,width:100,renderText:(t,o)=>o.type===0?X().unix(t).format(l.Ay.t("EXPLORER.DATE_TIME_FORMAT")):"-"},{key:"Option",width:120,title:"",dataIndex:"name",valueType:"option",ellipsis:!0,render:(t,o)=>pe(o)}],De={show:!0,search:!0,reload:!1,density:!1,setting:!1},H=(0,n.useRef)(),Te=(0,n.useMemo)(()=>(0,u.x)({height:300,vid:"file-table"}),[]),Ce=()=>n.createElement(c.A,{size:16},n.createElement(P.A,{title:l.Ay.t("EXPLORER.DOWNLOAD_MULTI_CONFIRM"),onConfirm:()=>le(Z)},n.createElement("a",null,l.Ay.t("EXPLORER.DOWNLOAD"))),n.createElement(P.A,{title:l.Ay.t("EXPLORER.DELETE_MULTI_CONFIRM"),onConfirm:()=>ce(Z)},n.createElement("a",null,l.Ay.t("EXPLORER.DELETE"))));(0,n.useEffect)(()=>{r.device&&(M=r.device.os==="windows",w="/",s("/")),r.open&&(V=[],h(!1))},[r.device,r.open]);function pe(t){let o=[{key:"editAsText",name:l.Ay.t("EXPLORER.EDIT_AS_TEXT")},{key:"delete",name:l.Ay.t("EXPLORER.DELETE")}];if(t.type===1)o.shift();else if(t.type===2)return[];return t.name===".."?[]:[n.createElement("a",{key:"download",onClick:()=>le(t.name)},l.Ay.t("EXPLORER.DOWNLOAD")),n.createElement(A.A,{key:"more",onSelect:i=>Me(i,t),menus:o})]}function Me(t,o){switch(t){case"delete":let i=l.Ay.t("EXPLORER.DELETE_CONFIRM");o.type===0?i=i.replace("{0}",l.Ay.t("EXPLORER.FILE")):i=i.replace("{0}",l.Ay.t("EXPLORER.FOLDER")),d.A.confirm({icon:n.createElement(_.A,null),content:i,onOk:ce.bind(null,o.name)});break;case"editAsText":ue(o)}}function Ie(t){const o=M?"\\":"/";if(t.name===".."){ne(Ee(w));return}if(t.type!==0){if(M&&(a==="/"||a==="\\"||a.length===0)){ne(t.name+o);return}ne(a+t.name+o);return}const i=t.name.split(".").pop().toLowerCase();if(["jpg","jpeg","png","gif","bmp"].includes(i)&&t.size<=2<<22){Ue(t);return}if(t.size<=2<<20){const J=Pe.getModeForPath(t.name);if(J&&J.extRe.test(t.name)){ue(t);return}}le(t.name)}function Ue(t){h(!0),(0,v.Em)("/api/device/file/get",{device:r.device.id,files:a+t.name},{},{responseType:"blob",timeout:1e4}).then(o=>{o.status===200&&(p.length>0&&URL.revokeObjectURL(p),g(URL.createObjectURL(o.data)))}).catch(v.bv).finally(()=>{h(!1)})}function ue(t){if(t.size>2<<20){L.Ay.warn(l.Ay.t("EXPLORER.FILE_TOO_LARGE"));return}se||(h(!0),(0,v.Em)("/api/device/file/text",{device:r.device.id,file:a+t.name},{},{responseType:"blob",timeout:7e3}).then(o=>{o.status===200&&o.data.text().then(i=>{Re(()=>{ie(i),T(!1),re(t.name)})})}).catch(v.bv).finally(()=>{h(!1)}))}function ne(t){m||(w=t,s(t),H.current.reload())}function Ee(t){let o=M?"\\":"/",f=t.substring(0,t.length-1).split(o);return f.pop(),f.length===0?"/":f.join(o)+o}function Se(){if((a==="/"||a==="\\"||a.length===0)&&M){L.Ay.error(l.Ay.t("EXPLORER.UPLOAD_INVALID_PATH"));return}document.getElementById("file-uploader").click()}function Be(t){let o=t.target.files[0];if(o!==void 0){t.target.value=null;{let i=!1;for(let f=0;f<V.length;f++)if(V[f].type===0&&V[f].name===o.name){i=!0;break}i?d.A.confirm({autoFocusButton:"cancel",content:l.Ay.t("EXPLORER.OVERWRITE_CONFIRM").replace("{0}",o.name),okText:l.Ay.t("EXPLORER.OVERWRITE"),onOk:()=>{q(o)},okButtonProps:{danger:!0}}):(q(o),T(!1))}}}function We(){H.current.reload(),q(!1),T(!0)}function Xe(){q(!1),T(!0)}function le(t){if((a==="/"||a==="\\"||a.length===0)&&M){L.Ay.error(l.Ay.t("EXPLORER.DOWNLOAD_VOLUMES_ERROR"));return}let o=[];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]!==".."&&o.push(a+t[i]);else o=a+t;(0,v.bE)(location.origin+location.pathname+"api/device/file/get",{files:o,device:r.device.id})}function ce(t){if((a==="/"||a==="\\"||a.length===0)&&M){L.Ay.error(l.Ay.t("EXPLORER.DELETE_INVALID_PATH"));return}let o=[];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]!==".."&&o.push(a+t[i]);else o=a+t;(0,v.Em)("/api/device/file/remove",{files:o,device:r.device.id},{},{transformRequest:[i=>N().stringify(i,{indices:!1})]}).then(i=>{i.data.code===0&&(L.Ay.success(l.Ay.t("EXPLORER.DELETE_SUCCESS")),H.current.reload())})}function xe(t){return Ae(this,null,function*(){var o;yield(0,v.zR)(300);let i=yield(0,v.Em)("/api/device/file/list",{path:w,device:r.device.id});de([]),h(!1);let f=i.data;if(f.code===0){let J=!1;if(t.keyword=(o=t.keyword)!=null?o:"",t.keyword.length>0){let $=t.keyword.toLowerCase(),Y=$.replace(/[.+^${}()|[\]\\]/g,"\\$&"),Ke=new RegExp(`^${Y.replace(/\*/g,".*").replace(/\?/g,".")}$`,"i");f.data.files=f.data.files.filter(fe=>fe.name.toLowerCase().includes($)?!0:Ke.test(fe.name))}return f.data.files=f.data.files.sort(($,Y)=>(0,v.u1)($.name,Y.name)),f.data.files=f.data.files.sort(($,Y)=>Y.type-$.type),a.length>0&&a!=="/"&&a!=="\\"&&(J=!0,f.data.files.unshift({name:"..",size:"0",type:3,modTime:0})),V=[].concat(f.data.files),s(w),{data:f.data.files,success:!0,total:f.data.files.length-(J?1:0)}}return s(Ee(w)),{data:[],success:!1,total:0}})}return n.createElement(U.default,ye({draggable:Q,maskClosable:!1,destroyOnClose:!0,modalTitle:l.Ay.t("EXPLORER.TITLE"),footer:null,width:830,bodyStyle:{padding:0}},r),n.createElement(E.Ay,{rowKey:"name",tableStyle:{minHeight:"320px",maxHeight:"320px"},onRow:t=>({onDoubleClick:Ie.bind(null,t)}),scroll:{scrollToFirstRowOnChange:!0,y:300},search:!1,size:"small",loading:m,rowClassName:"file-row",onLoadingChange:h,rowSelection:{selectedRowKeys:Z,onChange:de,alwaysShowAlert:!0},tableAlertRender:()=>l.Ay.t("EXPLORER.MULTI_SELECT_LABEL").replace("{0}",String(Z.length)).replace("{1}",String(V.length)),tableAlertOptionRender:Z.length===0?null:Ce,options:De,columns:Le,request:xe,pagination:!1,actionRef:H,components:Te}),n.createElement(B.A,{style:{right:"59px"},className:"header-button",icon:n.createElement(O.A,null),onClick:()=>{H.current.reload()}}),n.createElement(B.A,{style:{right:"115px"},className:"header-button",icon:n.createElement(D,null),onClick:Se}),n.createElement("input",{id:"file-uploader",type:"file",onChange:Be,style:{display:"none"}}),k&&n.createElement(k,{path:a,file:se,device:r.device,content:ge,onCancel:t=>{re(""),ie(""),T(!0),t&&H.current.reload()}}),n.createElement(ee.default,{open:z,path:a,file:z,device:r.device,onSuccess:We,onCancel:Xe}),n.createElement(W.A,{preview:{visible:p,src:p,onVisibleChange:()=>{URL.revokeObjectURL(p),g("")}}}))}function be(r){let a=M?"\\":"/",s=[],p=[],g=r.path;g.endsWith(a)&&(g=g.substring(0,g.length-1)),g.length>0&&g!=="/"&&g!=="\\"&&(s=g.split(a));for(let m=0;m<s.length;m++){let h=s[m];m===0&&M&&h.endsWith(":")&&(h=h.substring(0,h.length-1)),p.push({name:h,path:s.slice(0,m+1).join(a)+a})}if(s.length>0&&M){let m=s[0];m.endsWith(":")&&(m=m.substring(0,m.length-1)),s[0]=m}return p.pop(),React.createElement(Breadcrumb,{style:{marginLeft:"10px",marginRight:"10px"},disabled:r.loading},React.createElement(Breadcrumb.Item,{style:{cursor:"pointer"},onClick:r.onClick.bind(null,"/")},React.createElement(HomeOutlined,null)),p.map(m=>React.createElement(Breadcrumb.Item,{key:m.path,style:{cursor:"pointer"},onClick:r.onClick.bind(null,m.path)},m.name)),s.length>0?React.createElement(Breadcrumb.Item,null,s[s.length-1]):null)}const he=ve}}]);
