"use strict";(self.webpackChunkspark=self.webpackChunkspark||[]).push([[284,787],{20053:(h,A,t)=>{t.r(A),t.d(A,{default:()=>i});function E(a){var o,c,e="";if(typeof a=="string"||typeof a=="number")e+=a;else if(typeof a=="object")if(Array.isArray(a))for(o=0;o<a.length;o++)a[o]&&(c=E(a[o]))&&(e&&(e+=" "),e+=c);else for(o in a)a[o]&&(e&&(e+=" "),e+=o);return e}function i(){for(var a=0,o,c,e="";a<arguments.length;)(o=arguments[a++])&&(c=E(o))&&(e&&(e+=" "),e+=c);return e}},37848:(h,A,t)=>{t.d(A,{default:()=>v});var E=t(68275),i=t(96540),a=t(55794),o=t.n(a),c=Object.defineProperty,e=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,C=(n,l,r)=>l in n?c(n,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[l]=r,y=(n,l)=>{for(var r in l||(l={}))R.call(l,r)&&C(n,r,l[r]);if(e)for(var r of e(l))g.call(l,r)&&C(n,r,l[r]);return n};function d(n){const[l,r]=(0,i.useState)(!0),[u,U]=(0,i.useState)({left:0,top:0,bottom:0,right:0}),f=(0,i.useRef)(null),m=(D,s)=>{var _;const{clientWidth:T,clientHeight:M}=window.document.documentElement,O=(_=f.current)==null?void 0:_.getBoundingClientRect();!O||l||U({left:-O.left+s.x,right:T-(O.right-s.x),top:-O.top+s.y,bottom:M-(O.bottom-s.y)})};return i.createElement(E.A,y({title:i.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{l&&n.draggable&&r(!1)},onMouseOut:()=>{r(!0)},onFocus:()=>{},onBlur:()=>{r(!0)}},n.modalTitle),modalRender:D=>i.createElement(o(),{disabled:l||!n.draggable,bounds:u,onStart:(s,_)=>m(s,_)},i.createElement("div",{ref:f},D))},n),n.children)}const v=d},54055:(h,A,t)=>{t.d(A,{default:()=>r});var E=t(96540),i=t(55373),a=t.n(i),o=t(75427),c=t(72505),e=t.n(c),R=t(79478),g=t(68275),C=t(57427),y=t(26493),d=t(47730),v=t(37848);let n=null;function l(u){const[U,f]=(0,E.useState)(!!u.file),[m,D]=(0,E.useState)(0),[s,_]=(0,E.useState)(0);(0,E.useEffect)(()=>{_(0),u.file&&(f(!0),D(0))},[u.file]);function T(){if(s!==0){M();return}const I=a().stringify({device:u.device.id,path:u.path,file:u.file.name});let L=1;_(1),window.onbeforeunload=o.V3,n=new AbortController,e().post("/api/device/file/upload?"+I,u.file,{headers:{"Content-Type":"application/octet-stream"},timeout:0,onUploadProgress:P=>{let B=Math.round(P.loaded*100/P.total);D(B)},signal:n.signal}).then(P=>{P.data.code===0?(L=2,_(2),R.Ay.success(d.Ay.t("EXPLORER.UPLOAD_SUCCESS"))):(L=3,_(3))}).catch(P=>{e().isCancel(P)?(L=4,_(4),R.Ay.error(d.Ay.t("EXPLORER.UPLOAD_ABORTED"))):(L=3,_(3),R.Ay.error(d.Ay.t("EXPLORER.UPLOAD_FAILED")+d.Ay.t("COMMON.COLON")+P.message))}).finally(()=>{n=null,window.onbeforeunload=null,setTimeout(()=>{f(!1),L===2?u.onSuccess():u.onCancel()},1500)})}function M(){if(s===0){f(!1),setTimeout(u.onCancel,300);return}if(s===1){g.A.confirm({autoFocusButton:"cancel",content:d.Ay.t("EXPLORER.UPLOAD_CANCEL_CONFIRM"),onOk:()=>{n.abort()},okButtonProps:{danger:!0}});return}setTimeout(()=>{f(!1),setTimeout(u.onCancel,300)},1500)}function O(){switch(s){case 1:return m+"%";case 2:return d.Ay.t("EXPLORER.UPLOAD_SUCCESS");case 3:return d.Ay.t("EXPLORER.UPLOAD_FAILED");case 4:return d.Ay.t("EXPLORER.UPLOAD_ABORTED");default:return d.Ay.t("EXPLORER.UPLOAD")}}return E.createElement(v.default,{centered:!0,draggable:!0,open:U,closable:!1,keyboard:!1,maskClosable:!1,destroyOnClose:!0,confirmLoading:s===1,okText:d.Ay.t(s===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),modalTitle:d.Ay.t(s===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),okButtonProps:{disabled:s!==0},cancelButtonProps:{disabled:s>1},onCancel:M,onOk:T,width:550},E.createElement("div",null,E.createElement("span",{style:{whiteSpace:"nowrap",fontSize:"20px",marginRight:"10px"}},O()),E.createElement(y.A.Text,{ellipsis:{rows:1},style:{maxWidth:"calc(100% - 140px)"}},u.file.name),E.createElement("span",{style:{whiteSpace:"nowrap"}},"\uFF08"+(0,o.Xq)(u.file.size)+"\uFF09")),E.createElement(C.A,{strokeLinecap:"butt",percent:m,showInfo:!1}))}const r=l}}]);
