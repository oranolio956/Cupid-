"use strict";(self.webpackChunkspark=self.webpackChunkspark||[]).push([[284,934],{20053:(b,p,o)=>{o.r(p),o.d(p,{default:()=>r});function c(t){var u,m,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t))for(u=0;u<t.length;u++)t[u]&&(m=c(t[u]))&&(n&&(n+=" "),n+=m);else for(u in t)t[u]&&(n&&(n+=" "),n+=u);return n}function r(){for(var t=0,u,m,n="";t<arguments.length;)(u=arguments[t++])&&(m=c(u))&&(n&&(n+=" "),n+=m);return n}},37848:(b,p,o)=>{o.d(p,{default:()=>W});var c=o(68275),r=o(96540),t=o(55794),u=o.n(t),m=Object.defineProperty,n=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,S=(f,s,e)=>s in f?m(f,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[s]=e,w=(f,s)=>{for(var e in s||(s={}))N.call(s,e)&&S(f,e,s[e]);if(n)for(var e of n(s))B.call(s,e)&&S(f,e,s[e]);return f};function K(f){const[s,e]=(0,r.useState)(!0),[T,_]=(0,r.useState)({left:0,top:0,bottom:0,right:0}),d=(0,r.useRef)(null),I=(U,v)=>{var A;const{clientWidth:R,clientHeight:L}=window.document.documentElement,M=(A=d.current)==null?void 0:A.getBoundingClientRect();!M||s||_({left:-M.left+v.x,right:R-(M.right-v.x),top:-M.top+v.y,bottom:L-(M.bottom-v.y)})};return r.createElement(c.A,w({title:r.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{s&&f.draggable&&e(!1)},onMouseOut:()=>{e(!0)},onFocus:()=>{},onBlur:()=>{e(!0)}},f.modalTitle),modalRender:U=>r.createElement(u(),{disabled:s||!f.draggable,bounds:T,onStart:(v,A)=>I(v,A)},r.createElement("div",{ref:d},U))},f),f.children)}const W=K},80586:(b,p,o)=>{o.d(p,{default:()=>X});var c=o(96540),r=o(75427),t=o(47730),u=o(37848),m=o(50400),n=o(79478),N=o(78027),B=o(80581),S=Object.defineProperty,w=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,f=(E,O,y)=>O in E?S(E,O,{enumerable:!0,configurable:!0,writable:!0,value:y}):E[O]=y,s=(E,O)=>{for(var y in O||(O={}))K.call(O,y)&&f(E,y,O[y]);if(w)for(var y of w(O))W.call(O,y)&&f(E,y,O[y]);return E};let e=null,T=null,_=!1,d=null,I=null,U=0,v=0,A=0,R=0,L=t.Ay.t("DESKTOP.TITLE");function M(E){const[O,y]=(0,c.useState)("0x0"),[k,J]=(0,c.useState)(0),[G,H]=(0,c.useState)(0),Q=(0,c.useCallback)(l=>{l&&E.open&&!_&&!d&&(I=(0,r.s_)((0,r.Vv)(32)),d=l,F(d),$(d))},[E]);(0,c.useEffect)(()=>{E.open||(d=null,e&&_&&(clearInterval(U),e.close(),_=!1))},[E.open]);function F(){!d||(T=d.getContext("2d",{alpha:!1}),T.imageSmoothingEnabled=!1)}function $(){T!==null&&(e!==null&&_&&e.close(),e=new WebSocket((0,r.vo)(!0,`api/device/desktop?device=${E.device.id}&secret=${(0,r.G_)(I)}`)),e.binaryType="arraybuffer",e.onopen=()=>{_=!0},e.onmessage=l=>{Z(l.data,d,T)},e.onclose=()=>{_&&(_=!1,n.Ay.warn(t.Ay.t("COMMON.DISCONNECTED")))},e.onerror=l=>{console.error(l),_?(_=!1,n.Ay.warn(t.Ay.t("COMMON.DISCONNECTED"))):n.Ay.warn(t.Ay.t("COMMON.CONNECTION_FAILED"))},clearInterval(U),U=setInterval(()=>{J(A),H(v),A=0,v=0,R++,R>10&&_&&(R=0,j({act:"DESKTOP_PING"}))},1e3))}function Y(){d.requestFullscreen().catch(console.error)}function z(){d&&E.open&&(_?j({act:"DESKTOP_SHOT"}):(F(d),$(d)))}function Z(l,a,P){l=l.slice(5);let g=new DataView(l),h=g.getUint8(0);if(h===3){q(l.slice(1));return}if(h===2){let D=g.getUint16(3,!1),C=g.getUint16(5,!1);if(D===0||C===0)return;a.width=D,a.height=C,y(`${D}x${C}`);return}h===0&&v++,A+=l.byteLength;let i=1;for(;i<l.byteLength;){let D=g.getUint16(i+0,!1),C=g.getUint16(i+2,!1),ee=g.getUint16(i+4,!1),te=g.getUint16(i+6,!1),ne=g.getUint16(i+8,!1),le=g.getUint16(i+10,!1),V=D-10;i+=12,x(l.slice(i,i+V),C,ee,te,ne,le,P),i+=V}g=null}function x(l,a,P,g,h,i,D){switch(a){case 0:D.putImageData(new ImageData(new Uint8ClampedArray(l),h,i),P,g,0,0,h,i);break;case 1:createImageBitmap(new Blob([l]),0,0,h,i,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(C=>{D.drawImage(C,0,0,h,i,P,g,h,i)});break}}function q(l){let a=(0,r.Yc)(l,I);try{a=JSON.parse(a)}catch(P){}if((a==null?void 0:a.act)==="WARN"){n.Ay.warn(a.msg?(0,r.Tl)(a.msg):t.Ay.t("COMMON.UNKNOWN_ERROR"));return}(a==null?void 0:a.act)==="QUIT"&&(n.Ay.warn(a.msg?(0,r.Tl)(a.msg):t.Ay.t("COMMON.UNKNOWN_ERROR")),_=!1,e.close())}function j(l){if(_){let a=(0,r.w)((0,r.Sc)(JSON.stringify(l)),I),P=new Uint8Array(a.length+8);P.set(new Uint8Array([34,22,19,17,20,3]),0),P.set(new Uint8Array([a.length>>8,a.length&255]),6),P.set(a,8),e.send(P)}}return c.createElement(u.default,s({draggable:!0,maskClosable:!1,destroyOnClose:!0,modalTitle:`${L} ${O} ${(0,r.Xq)(k)}/s FPS: ${G}`,footer:null,height:480,width:940,bodyStyle:{padding:0}},E),c.createElement("canvas",{id:"painter",ref:Q,style:{width:"100%",height:"100%"}}),c.createElement(m.A,{style:{right:"59px"},className:"header-button",icon:c.createElement(N.A,null),onClick:Y}),c.createElement(m.A,{style:{right:"115px"},className:"header-button",icon:c.createElement(B.A,null),onClick:z}))}const X=M}}]);
