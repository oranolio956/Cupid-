"use strict";(self.webpackChunkspark=self.webpackChunkspark||[]).push([[868,921],{86010:(Z,D,l)=>{l.r(D),l.d(D,{default:()=>r});function f(t){var u,_,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t))for(u=0;u<t.length;u++)t[u]&&(_=f(t[u]))&&(o&&(o+=" "),o+=_);else for(u in t)t[u]&&(o&&(o+=" "),o+=u);return o}function r(){for(var t=0,u,_,o="";t<arguments.length;)(u=arguments[t++])&&(_=f(u))&&(o&&(o+=" "),o+=_);return o}},24477:(Z,D,l)=>{l.r(D),l.d(D,{default:()=>V});var f=l(67294),r=l(81027),t=l(37240),u=l(47181),_=l(48086),o=l(71577),B=l(38296),w=l(59879),A=Object.defineProperty,N=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,c=(O,g,m)=>g in O?A(O,g,{enumerable:!0,configurable:!0,writable:!0,value:m}):O[g]=m,s=(O,g)=>{for(var m in g||(g={}))K.call(g,m)&&c(O,m,g[m]);if(N)for(var m of N(g))W.call(g,m)&&c(O,m,g[m]);return O};let e=null,T=null,d=!1,E=null,p=null,R=0,v=0,M=0,S=0,L=t.ZP.t("DESKTOP.TITLE");function I(O){const[g,m]=(0,f.useState)("0x0"),[H,J]=(0,f.useState)(0),[X,G]=(0,f.useState)(0),Q=(0,f.useCallback)(n=>{n&&O.open&&!d&&!E&&(p=(0,r.vS)((0,r.ym)(32)),E=n,b(E),F(E))},[O]);(0,f.useEffect)(()=>{O.open||(E=null,e&&d&&(clearInterval(R),e.close(),d=!1))},[O.open]);function b(){!E||(T=E.getContext("2d",{alpha:!1}),T.imageSmoothingEnabled=!1)}function F(){T!==null&&(e!==null&&d&&e.close(),e=new WebSocket((0,r.BS)(!0,`api/device/desktop?device=${O.device.id}&secret=${(0,r.nc)(p)}`)),e.binaryType="arraybuffer",e.onopen=()=>{d=!0},e.onmessage=n=>{k(n.data,E,T)},e.onclose=()=>{d&&(d=!1,_.ZP.warn(t.ZP.t("COMMON.DISCONNECTED")))},e.onerror=n=>{console.error(n),d?(d=!1,_.ZP.warn(t.ZP.t("COMMON.DISCONNECTED"))):_.ZP.warn(t.ZP.t("COMMON.CONNECTION_FAILED"))},clearInterval(R),R=setInterval(()=>{J(M),G(v),M=0,v=0,S++,S>10&&d&&(S=0,$({act:"DESKTOP_PING"}))},1e3))}function z(){E.requestFullscreen().catch(console.error)}function Y(){E&&O.open&&(d?$({act:"DESKTOP_SHOT"}):(b(E),F(E)))}function k(n,a,h){n=n.slice(5);let P=new DataView(n),y=P.getUint8(0);if(y===3){q(n.slice(1));return}if(y===2){let C=P.getUint16(3,!1),U=P.getUint16(5,!1);if(C===0||U===0)return;a.width=C,a.height=U,m(`${C}x${U}`);return}y===0&&v++,M+=n.byteLength;let i=1;for(;i<n.byteLength;){let C=P.getUint16(i+0,!1),U=P.getUint16(i+2,!1),ee=P.getUint16(i+4,!1),te=P.getUint16(i+6,!1),ne=P.getUint16(i+8,!1),le=P.getUint16(i+10,!1),j=C-10;i+=12,x(n.slice(i,i+j),U,ee,te,ne,le,h),i+=j}P=null}function x(n,a,h,P,y,i,C){switch(a){case 0:C.putImageData(new ImageData(new Uint8ClampedArray(n),y,i),h,P,0,0,y,i);break;case 1:createImageBitmap(new Blob([n]),0,0,y,i,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(U=>{C.drawImage(U,0,0,y,i,h,P,y,i)});break}}function q(n){let a=(0,r.pe)(n,p);try{a=JSON.parse(a)}catch(h){}if((a==null?void 0:a.act)==="WARN"){_.ZP.warn(a.msg?(0,r.Iu)(a.msg):t.ZP.t("COMMON.UNKNOWN_ERROR"));return}(a==null?void 0:a.act)==="QUIT"&&(_.ZP.warn(a.msg?(0,r.Iu)(a.msg):t.ZP.t("COMMON.UNKNOWN_ERROR")),d=!1,e.close())}function $(n){if(d){let a=(0,r.HI)((0,r.by)(JSON.stringify(n)),p),h=new Uint8Array(a.length+8);h.set(new Uint8Array([34,22,19,17,20,3]),0),h.set(new Uint8Array([a.length>>8,a.length&255]),6),h.set(a,8),e.send(h)}}return f.createElement(u.default,s({draggable:!0,maskClosable:!1,destroyOnClose:!0,modalTitle:`${L} ${g} ${(0,r.BU)(H)}/s FPS: ${X}`,footer:null,height:480,width:940,bodyStyle:{padding:0}},O),f.createElement("canvas",{id:"painter",ref:Q,style:{width:"100%",height:"100%"}}),f.createElement(o.Z,{style:{right:"59px"},className:"header-button",icon:f.createElement(B.Z,null),onClick:z}),f.createElement(o.Z,{style:{right:"115px"},className:"header-button",icon:f.createElement(w.Z,null),onClick:Y}))}const V=I},47181:(Z,D,l)=>{l.r(D),l.d(D,{default:()=>W});var f=l(50146),r=l(67294),t=l(61193),u=l.n(t),_=Object.defineProperty,o=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,A=(c,s,e)=>s in c?_(c,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[s]=e,N=(c,s)=>{for(var e in s||(s={}))B.call(s,e)&&A(c,e,s[e]);if(o)for(var e of o(s))w.call(s,e)&&A(c,e,s[e]);return c};function K(c){const[s,e]=(0,r.useState)(!0),[T,d]=(0,r.useState)({left:0,top:0,bottom:0,right:0}),E=(0,r.useRef)(null),p=(R,v)=>{var M;const{clientWidth:S,clientHeight:L}=window.document.documentElement,I=(M=E.current)==null?void 0:M.getBoundingClientRect();!I||s||d({left:-I.left+v.x,right:S-(I.right-v.x),top:-I.top+v.y,bottom:L-(I.bottom-v.y)})};return r.createElement(f.Z,N({title:r.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{s&&c.draggable&&e(!1)},onMouseOut:()=>{e(!0)},onFocus:()=>{},onBlur:()=>{e(!0)}},c.modalTitle),modalRender:R=>r.createElement(u(),{disabled:s||!c.draggable,bounds:T,onStart:(v,M)=>p(v,M)},r.createElement("div",{ref:E},R))},c),c.children)}const W=K}}]);
