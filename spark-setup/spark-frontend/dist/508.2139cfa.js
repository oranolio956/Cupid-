(self.webpackChunkspark=self.webpackChunkspark||[]).push([[284,508],{1779:N=>{var P=function(){"use strict";function o(n,s,d,u){var x;typeof s=="object"&&(d=s.depth,u=s.prototype,x=s.filter,s=s.circular);var y=[],b=[],A=typeof Buffer!="undefined";typeof s=="undefined"&&(s=!0),typeof d=="undefined"&&(d=1/0);function v(m,O){if(m===null)return null;if(O==0)return m;var e,r;if(typeof m!="object")return m;if(o.__isArray(m))e=[];else if(o.__isRegExp(m))e=new RegExp(m.source,_(m)),m.lastIndex&&(e.lastIndex=m.lastIndex);else if(o.__isDate(m))e=new Date(m.getTime());else{if(A&&Buffer.isBuffer(m))return Buffer.allocUnsafe?e=Buffer.allocUnsafe(m.length):e=new Buffer(m.length),m.copy(e),e;typeof u=="undefined"?(r=Object.getPrototypeOf(m),e=Object.create(r)):(e=Object.create(u),r=u)}if(s){var a=y.indexOf(m);if(a!=-1)return b[a];y.push(m),b.push(e)}for(var C in m){var T;r&&(T=Object.getOwnPropertyDescriptor(r,C)),!(T&&T.set==null)&&(e[C]=v(m[C],O-1))}return e}return v(n,d)}o.clonePrototype=function(s){if(s===null)return null;var d=function(){};return d.prototype=s,new d};function t(n){return Object.prototype.toString.call(n)}o.__objToStr=t;function h(n){return typeof n=="object"&&t(n)==="[object Date]"}o.__isDate=h;function c(n){return typeof n=="object"&&t(n)==="[object Array]"}o.__isArray=c;function l(n){return typeof n=="object"&&t(n)==="[object RegExp]"}o.__isRegExp=l;function _(n){var s="";return n.global&&(s+="g"),n.ignoreCase&&(s+="i"),n.multiline&&(s+="m"),s}return o.__getRegExpFlags=_,o}();N.exports&&(N.exports=P)},3434:N=>{"use strict";var P=N.exports;const o=24,t=17,h=19,c=128|t,l=128|h,_=24;P.ZMLIB={ZDLE:o,XON:t,XOFF:h,ABORT_SEQUENCE:[_,_,_,_,_],strip_ignored_bytes:function(s){for(var d=s.length-1;d>=0;d--)switch(s[d]){case t:case c:case h:case l:s.splice(d,1);continue}return s},find_subarray:function(s,d){var u=0,x,y=Date.now();e:for(;u!==-1;){if(u=s.indexOf(d[0],u),u===-1)break e;for(x=1;x<d.length;x++)if(s[u+x]!==d[x]){u++;continue e}return u}return-1}}},5275:N=>{class P{encode(c){c=unescape(encodeURIComponent(c));for(var l=new Array(c.length),_=0;_<c.length;_++)l[_]=c.charCodeAt(_);return new Uint8Array(l)}}class o{decode(c){return decodeURIComponent(escape(String.fromCharCode.apply(String,c)))}}var t=N.exports;t.Text={Encoder:typeof TextEncoder!="undefined"?TextEncoder:P,Decoder:typeof TextDecoder!="undefined"?TextDecoder:o}},5555:(N,P,o)=>{"use strict";var t=N.exports;Object.assign(t,o(15584));const h=/\*\x18[AC]|\*\*\x18B/;function c(l,_){if(_<0)throw new t.Error("validation","\u201C"+l+"\u201D ("+_+") must be nonnegative.");if(_!==Math.floor(_))throw new t.Error("validation","\u201C"+l+"\u201D ("+_+") must be an integer.")}t.Validation={offer_parameters:function(_){if(!_.name)throw new t.Error("validation","Need \u201Cname\u201D!");if(typeof _.name!="string")throw new t.Error("validation","\u201Cname\u201D ("+_.name+") must be a string!");if(_=Object.assign({},_),h.test(_.name)&&console.warn("The filename "+JSON.stringify(name)+" contains characters that look like a ZMODEM header. This could corrupt the ZMODEM session; consider renaming it so that the filename doesn\u2019t contain control characters."),_.serial!==null&&_.serial!==void 0)throw new t.Error("validation","\u201Cserial\u201D is meaningless.");if(_.serial=null,["size","mode","files_remaining","bytes_remaining"].forEach(function(d){var u;switch(typeof _[d]){case"object":u=_[d]===null;break;case"undefined":_[d]=null,u=!0;break;case"number":c(d,_[d]),u=!0;break}if(!u)throw new t.Error("validation","\u201C"+d+"\u201D ("+_[d]+") must be null, undefined, or a number.")}),typeof _.mode=="number"&&(_.mode|=32768),_.files_remaining===0)throw new t.Error("validation","\u201Cfiles_remaining\u201D, if given, must be positive.");var n;switch(typeof _.mtime){case"object":if(n=!0,_.mtime instanceof Date){var s=_.mtime;if(_.mtime=Math.floor(s.getTime()/1e3),_.mtime<0)throw new t.Error("validation","\u201Cmtime\u201D ("+s+") must not be earlier than 1970.")}else _.mtime!==null&&(n=!1);break;case"undefined":_.mtime=null,n=!0;break;case"number":c("mtime",_.mtime),n=!0;break}if(!n)throw new t.Error("validation","\u201Cmtime\u201D ("+_.mtime+") must be null, undefined, a Date, or a number.");return _}}},8136:(N,P,o)=>{"use strict";o.d(P,{default:()=>ce});var t=o(96540),h=o(50400),c=o(11721),l=o(19973),_=o(79478),n=o(40570),s=o(62975),d=o.n(s),u=o(98727),x=o.n(u),y=o(29195),b=o.n(y),A=o(38221),v=o.n(A),m=o(74633),O=o.n(m),e=o(55065),r=o(47730),a=o(75427),C=o(37848);const T=o(36320);let M=null,D=null,f=null,k=null,i=null,Z=null,F=null,S=null,Q=!1,W=!1,_e=0,j={content:"",output:""};function oe(q){let X=q.device.os,G=(0,t.createRef)(),ie=(0,t.useCallback)(p=>{p!==null&&(ie.current=p,q.open&&(F=(0,a.s_)((0,a.Vv)(32)),k=new y.FitAddon,f=new u.WebLinksAddon,i=new s.Terminal({convertEol:!0,allowProposedApi:!0,allowTransparency:!1,cursorBlink:!0,cursorStyle:"block",fontFamily:"Hack, monospace",fontSize:16,logLevel:"off"}),Z=ne(null),i.loadAddon(k),i.open(ie.current),k.fit(),i.clear(),i.loadAddon(f),window.onresize=he,_e=setInterval(()=>{W&&re({act:"PING"})},1e4),i.focus(),fe()))},[q.open]);function le(){clearInterval(_e),D&&(D._last_header_name="ZRINIT",D.close(),D=null),W&&(re({act:"TERMINAL_KILL"}),S.onclose=null,S.close()),Z==null||Z.dispose(),Z=null,k==null||k.dispose(),k=null,f==null||f.dispose(),f=null,M=null,i==null||i.dispose(),i=null,S=null,W=!1,Q=!1}function ne(p){p==null||p.dispose(),j={content:"",output:""};let g=null;return X==="windows"?g=i.onData(I(j)):(U(),g=i.onData(B(j))),S=new WebSocket((0,a.vo)(!0,`api/device/terminal?device=${q.device.id}&secret=${(0,a.G_)(F)}`)),S.binaryType="arraybuffer",S.onopen=()=>{W=!0},S.onmessage=L=>{R(L.data,j)},S.onclose=L=>{W&&(W=!1,i.write(`
${r.Ay.t("COMMON.DISCONNECTED")}
`),F=(0,a.s_)((0,a.Vv)(32)),D!==null&&(D._last_header_name="ZRINIT",D.close(),D=null))},S.onerror=L=>{console.error(L),W?(W=!1,i.write(`
${r.Ay.t("COMMON.DISCONNECTED")}
`),F=(0,a.s_)((0,a.Vv)(32)),D!==null&&(D._last_header_name="ZRINIT",D.close(),D=null)):i.write(`
${r.Ay.t("COMMON.CONNECTION_FAILED")}
`)},g}function R(p){var g;if(p=new Uint8Array(p),p[0]===34&&p[1]===22&&p[2]===19&&p[3]===17&&p[4]===21&&p[5]===0)if(p=p.slice(8),M===null)E((0,a.ko)(p));else try{M.consume(p)}catch(L){console.error(L)}else{p=(0,a.Yc)(p,F);try{p=JSON.parse(p)}catch(L){}if(W){if((p==null?void 0:p.act)==="TERMINAL_OUTPUT"){if(p=(0,a.s_)((g=p==null?void 0:p.data)==null?void 0:g.output),M===null)E((0,a.ko)(p));else try{M.consume(p)}catch(L){console.error(L)}return}if((p==null?void 0:p.act)==="WARN"){_.Ay.warn(p.msg?(0,a.Tl)(p.msg):r.Ay.t("COMMON.UNKNOWN_ERROR"));return}if((p==null?void 0:p.act)==="QUIT"){_.Ay.warn(p.msg?(0,a.Tl)(p.msg):r.Ay.t("COMMON.UNKNOWN_ERROR")),S.close();return}}}}function E(p){if(j.output.length>0&&(p=j.output+p,j.output=""),j.content.length>0)if(p.length>=j.content.length)p.startsWith(j.content)&&(p=p.substring(j.content.length),j.content="");else{j.output=p;return}i.write(p)}function I(p){let g="",L=0,w=0,K=[],z="",ee=0;return function(H){if(!W){(H==="\r"||H===`
`||H===" ")&&(i.write(`
${r.Ay.t("COMMON.RECONNECTING")}
`),Z=ne(Z));return}switch(H){case"\x1B[A":L>0&&L<=K.length&&(L===K.length&&(z=g,ee=w),L--,V(),g=K[L],w=g.length,i.write(g));break;case"\x1B[B":L+1<K.length?(L++,V(),g=K[L],w=g.length,i.write(g)):L+1<=K.length&&(V(),L++,g=z,w=ee,i.write(g),i.write("\x1B[D".repeat(O()(g.substring(w)))),z="",ee=0);break;case"\x1B[C":w<g.length&&(i.write("\x1B[C".repeat(O()(g[w]))),w++);break;case"\x1B[D":w>0&&(i.write("\x1B[D".repeat(O()(g[w-1]))),w--);break;case"\r":case`
`:g==="clear"||g==="cls"?(V(),i.clear()):(i.write(`
`),$(g+`
`),p.content=g+`
`),g.length>0&&K.push(g),w=0,g="",K.length>128&&(K=K.slice(K.length-128)),z="",ee=0,L=K.length;break;case"\x7F":if(g.length>0&&w>0){w--;let Y=O()(g[w]),te=g.substring(0,w),se=g.substring(w+1);g=te+se,i.write("\b".repeat(Y)),i.write(se+" ".repeat(Y)),i.write("\x1B[D".repeat(O()(se)+Y))}break;default:if(H>=String.fromCharCode(32)&&H<=String.fromCharCode(123)||H>="\xA0"){if(w<g.length){let Y=g.substring(0,w),te=g.substring(w);g=Y+H+te,i.write(H+te),i.write("\x1B[D".repeat(O()(te)))}else g+=H,i.write(H);w+=H.length}}};function V(){let H=g.substring(0,w),Y=g.substring(w);i.write("\b".repeat(O()(H))),i.write(" ".repeat(O()(g))),i.write("\b".repeat(O()(g)))}}function B(p){return function(g){if(!W){(g==="\r"||g===" ")&&(i.write(`
${r.Ay.t("COMMON.RECONNECTING")}
`),Z=ne(Z));return}ae(g)}}function U(){const p=()=>{G.current.setFileSelect(!1),D._last_header_name="ZRINIT",D.close(),D=null};M=new T.Sentry({on_retract:()=>{},on_detect:w=>{D!==null&&p(),D=w.confirm(),D.type==="send"?g(D):L(D)},to_terminal:w=>{E((0,a.ko)(new Uint8Array(w)))},sender:w=>{re(new Uint8Array(w),!0)}});function g(){return new Promise((w,K)=>{let z=document.getElementById("file-uploader"),ee=!1;z.onchange=V=>{if(G.current.setFileSelect(!1),D===null){V.target.value=null,_.Ay.warn(r.Ay.t("TERMINAL.ZMODEM_UPLOADER_CALL_TIMEOUT"));return}let H=V.target.files[0];if(H===void 0){i.write(`
`+r.Ay.t("TERMINAL.ZMODEM_UPLOADER_NO_FILE")+`
`),p(),K("NO_FILE_SELECTED");return}ee=!0,V.target.value=null,i.write(`
`+H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_START")+`
`),T.Browser.send_files(D,[H],{on_offer_response:(Y,te)=>{te||(i.write(Y.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_REJECTED")+`
`),K("TRANSFER_REJECTED"))},on_file_complete:()=>{i.write(H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_SUCCESS")+`
`),w()}}).catch(Y=>{console.error(Y),i.write(H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_FAILED")+`
`),K(Y)}).finally(()=>{p()})},i.write(`
`+r.Ay.t("TERMINAL.ZMODEM_UPLOADER_TIP")),i.write(`
`+r.Ay.t("TERMINAL.ZMODEM_UPLOADER_WARNING")+`
`),G.current.setFileSelect(()=>{z.click()}),z.click(),setTimeout(()=>{ee||(i.write(`
`+r.Ay.t("TERMINAL.ZMODEM_UPLOADER_CALL_TIMEOUT")+`
`),p(),K("UPLOADER_CALL_TIMEOUT"))},1e4)})}function L(){return new Promise((w,K)=>{let z=!1,ee=!1;D.on("offer",V=>{let H=V.get_details();if(H.size>16*1024*1024)V.skip(),i.write(`
`+H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_FILE_TOO_LARGE")+`
`);else{let Y=H.name,te=[];V.on("input",se=>{te.push(new Uint8Array(se))}),V.accept().then(()=>{T.Browser.save_to_disk(te,Y),i.write(`
`+H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_SUCCESS")+`
`),z=!0,w()}).catch(se=>{console.error(se),i.write(`
`+H.name+"	"+r.Ay.t("TERMINAL.ZMODEM_TRANSFER_FAILED")+`
`),ee=!0,K()})}}),D.on("session_end",()=>{D=null,!z&&!ee&&K()}),D.start()})}}function $(p){W&&re({act:"TERMINAL_INPUT",data:{input:(0,a.vm)(p)}})}function ae(p){if(W){if(Q&&p.length===1){let g=p.charCodeAt(0);g>=97&&g<=122?(g-=96,Q=!1,G.current.setCtrl(!1)):g>=64&&g<=95&&(g-=64,Q=!1,G.current.setCtrl(!1)),p=String.fromCharCode(g)}re({act:"TERMINAL_INPUT",data:{input:(0,a.vm)(p)}})}}function re(p,g){if(W){let L=[];if(g)if(p.length>65536){let K=0;for(;K<p.length;){let z=p.slice(K,K+65536);re(z,!0),K+=z.length}}else L=p;else L=(0,a.w)((0,a.Sc)(JSON.stringify(p)),F);let w=new Uint8Array(L.length+8);w.set(new Uint8Array([34,22,19,17,21,g?0:1]),0),w.set(new Uint8Array([L.length>>8,L.length&255]),6),w.set(L,8),S.send(w)}}function fe(){var p,g,L;let w=document.body.clientHeight,K=Math.floor(w/42),z=i==null?void 0:i.cols;(p=k==null?void 0:k.fit)==null||p.call(k),(g=i==null?void 0:i.resize)==null||g.call(i,z,K),(L=i==null?void 0:i.scrollToBottom)==null||L.call(i),W&&re({act:"TERMINAL_RESIZE",data:{cols:z,rows:K}})}function he(){typeof fe=="function"&&v()(fe,70)}function Ee(p){var g;if((g=i==null?void 0:i.focus)==null||g.call(i),!W&&p){G.current.setCtrl(!1);return}Q=p}function pe(p,g){var L;ae(p),g&&((L=i==null?void 0:i.focus)==null||L.call(i))}return t.createElement(C.default,{draggable:!0,maskClosable:!1,modalTitle:r.Ay.t("TERMINAL.TITLE"),open:q.open,onCancel:q.onCancel,bodyStyle:{padding:12},afterClose:le,destroyOnClose:!0,footer:null,height:250,width:900},t.createElement(J,{ref:G,onCtrl:Ee,onExtKey:pe,open:X!=="windows"}),t.createElement("div",{style:{padding:"0 0 0 5px",backgroundColor:"#000"},ref:ie}),t.createElement("input",{id:"file-uploader",type:"file",style:{display:"none"}}))}class J extends t.Component{constructor(X){super(X),this.open=X.open,this.open&&(this.funcKeys=[{key:"\x1BOP",label:"F1"},{key:"\x1BOQ",label:"F2"},{key:"\x1BOR",label:"F3"},{key:"\x1BOS",label:"F4"},{key:"\x1B[15~",label:"F5"},{key:"\x1B[17~",label:"F6"},{key:"\x1B[18~",label:"F7"},{key:"\x1B[19~",label:"F8"},{key:"\x1B[20~",label:"F9"},{key:"\x1B[21~",label:"F10"},{key:"\x1B[23~",label:"F11"},{key:"\x1B[24~",label:"F12"}],this.specialKeys=[{key:"\x1B[1~",label:"HOME"},{key:"\x1B[2~",label:"INS"},{key:"\x1B[3~",label:"DEL"},{key:"\x1B[4~",label:"END"},{key:"\x1B[5~",label:"PGUP"},{key:"\x1B[6~",label:"PGDN"}],this.funcMenu=t.createElement(l.A,{onClick:this.onKey.bind(this)},this.funcKeys.map(G=>t.createElement(l.A.Item,{key:G.key},G.label))),this.specialMenu=t.createElement(l.A,{onClick:this.onKey.bind(this)},this.specialKeys.map(G=>t.createElement(l.A.Item,{key:G.key},G.label))),this.state={ctrl:!1,fileSelect:!1})}onCtrl(){this.setState({ctrl:!this.state.ctrl}),this.props.onCtrl(!this.state.ctrl)}onKey(X){this.props.onExtKey(X.key,!1)}onExtKey(X){this.props.onExtKey(X,!0)}onFileSelect(){typeof this.state.fileSelect=="function"&&this.state.fileSelect()}setCtrl(X){this.setState({ctrl:X})}setFileSelect(X){this.setState({fileSelect:X})}render(){return this.open?t.createElement(n.A,{style:{paddingBottom:12}},t.createElement(t.Fragment,null,t.createElement(h.A,{type:this.state.ctrl?"primary":"default",onClick:this.onCtrl.bind(this)},"CTRL"),t.createElement(h.A,{onClick:this.onExtKey.bind(this,"\x1B")},"ESC"),t.createElement(h.A,{onClick:this.onExtKey.bind(this,"	")},"TAB")),t.createElement(t.Fragment,null,t.createElement(h.A,{onClick:this.onExtKey.bind(this,"\x1B[A")},"\u2B06"),t.createElement(h.A,{onClick:this.onExtKey.bind(this,"\x1B[B")},"\u2B07"),t.createElement(h.A,{onClick:this.onExtKey.bind(this,"\x1B[C")},"\u27A1"),t.createElement(h.A,{onClick:this.onExtKey.bind(this,"\x1B[D")},"\u2B05")),t.createElement(c.A.Button,{overlay:this.specialMenu},r.Ay.t("TERMINAL.SPECIAL_KEYS")),t.createElement(c.A.Button,{overlay:this.funcMenu},r.Ay.t("TERMINAL.FUNCTION_KEYS")),this.state.fileSelect?t.createElement(h.A,{onClick:this.onFileSelect.bind(this)},"\u9009\u62E9\u6587\u4EF6"):null):null}}const ce=oe},15584:N=>{"use strict";var P=N.exports;function o(l,_){return this.got=l.slice(0),this.expected=_.slice(0),"CRC check failed! (got: "+l.join()+"; expected: "+_.join()+")"}function t(l){return l}const h={aborted:"Session aborted",peer_aborted:"Peer aborted session",already_aborted:"Session already aborted",crc:o,validation:t};function c(l){const _=h[l];switch(typeof _){case"string":return _;case"function":var n=[].slice.call(arguments).slice(1);return _.apply(this,n)}return null}P.Error=class extends Error{constructor(_){super();var n=c.apply(this,arguments);n?(this.type=_,this.message=n):this.message=_}}},20053:(N,P,o)=>{"use strict";o.r(P),o.d(P,{default:()=>h});function t(c){var l,_,n="";if(typeof c=="string"||typeof c=="number")n+=c;else if(typeof c=="object")if(Array.isArray(c))for(l=0;l<c.length;l++)c[l]&&(_=t(c[l]))&&(n&&(n+=" "),n+=_);else for(l in c)c[l]&&(n&&(n+=" "),n+=l);return n}function h(){for(var c=0,l,_,n="";c<arguments.length;)(l=arguments[c++])&&(_=t(l))&&(n&&(n+=" "),n+=_);return n}},27637:(N,P,o)=>{"use strict";var t=N.exports;Object.assign(t,o(3434));var h,c;const l=t.ZMLIB.ZDLE;t.ZDLE=class de{constructor(n){this._config={},n&&this.set_escape_ctrl_chars(!!n.escape_ctrl_chars)}set_escape_ctrl_chars(n){if(typeof n!="boolean")throw"need boolean!";n!==this._config.escape_ctrl_chars&&(this._config.escape_ctrl_chars=n,this._setup_zdle_table())}escapes_ctrl_chars(){return!!this._config.escape_ctrl_chars}encode(n){if(!this._zdle_table)throw"No ZDLE encode table configured!";var s=this._zdle_table,d=this._lastcode,u=new ArrayBuffer(2*n.length),x=new Uint8Array(u),y=this._config.escape_ctrl_chars,b=0;for(h=0;h<n.length;h++){if(c=s[n[h]],!c)throw console.trace(),console.error("bad encode() call:",JSON.stringify(n)),this._lastcode=d,"Invalid octet: "+n[h];d=n[h],c===1||(y||c===2||(d&127)===64)&&(x[b]=l,b++,d^=64),x[b]=d,b++}return this._lastcode=d,n.splice(0),n.push.apply(n,new Uint8Array(u,0,b)),n}static decode(n){for(var s=n.length-1;s>=0;s--)n[s]===l&&n.splice(s,2,n[s+1]-64);return n}static splice(n,s,d){var u=0;s||(s=0);for(var x=s;x<n.length&&u<d;x++)u++,n[x]===l&&x++;if(u===d)return n.length===x-1?void 0:(n.splice(0,s),de.decode(n.splice(0,x-s)))}_setup_zdle_table(){for(var n=new Array(256),s=0;s<n.length;s++)if(s&96)n[s]=1;else switch(s){case l:case t.ZMLIB.XOFF:case t.ZMLIB.XON:case t.ZMLIB.XOFF|128:case t.ZMLIB.XON|128:n[s]=2;break;case 16:case 144:n[s]=this._config.turbo_escape?1:2;break;case 13:case 141:n[s]=this._config.escape_ctrl_chars?2:this._config.turbo_escape?1:3;break;default:n[s]=this._config.escape_ctrl_chars?2:1}this._zdle_table=n}}},36320:(N,P,o)=>{Object.assign(N.exports,o(68683),o(47451))},37848:(N,P,o)=>{"use strict";o.d(P,{default:()=>b});var t=o(68275),h=o(96540),c=o(55794),l=o.n(c),_=Object.defineProperty,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,u=(A,v,m)=>v in A?_(A,v,{enumerable:!0,configurable:!0,writable:!0,value:m}):A[v]=m,x=(A,v)=>{for(var m in v||(v={}))s.call(v,m)&&u(A,m,v[m]);if(n)for(var m of n(v))d.call(v,m)&&u(A,m,v[m]);return A};function y(A){const[v,m]=(0,h.useState)(!0),[O,e]=(0,h.useState)({left:0,top:0,bottom:0,right:0}),r=(0,h.useRef)(null),a=(C,T)=>{var M;const{clientWidth:D,clientHeight:f}=window.document.documentElement,k=(M=r.current)==null?void 0:M.getBoundingClientRect();!k||v||e({left:-k.left+T.x,right:D-(k.right-T.x),top:-k.top+T.y,bottom:f-(k.bottom-T.y)})};return h.createElement(t.A,x({title:h.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{v&&A.draggable&&m(!1)},onMouseOut:()=>{m(!0)},onFocus:()=>{},onBlur:()=>{m(!0)}},A.modalTitle),modalRender:C=>h.createElement(l(),{disabled:v||!A.draggable,bounds:O,onStart:(T,M)=>a(T,M)},h.createElement("div",{ref:r},C))},A),A.children)}const b=y},39786:N=>{"use strict";var P=N.exports;const o=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102],t={};for(var h=0;h<o.length;h++)t[o[h]]=h;P.ENCODELIB={pack_u16_be:function(l){if(l>65535)throw"Number cannot exceed 16 bits: "+l;return[l>>8,l&255]},pack_u32_le:function(l){var _=l/65536;return[l&255,(l&65535)>>8,_&255,_>>8]},unpack_u16_be:function(l){return(l[0]<<8)+l[1]},unpack_u32_le:function(l){return l[0]+(l[1]<<8)+(l[2]<<16)+l[3]*16777216},octets_to_hex:function(l){for(var _=[],n=0;n<l.length;n++)_.push(o[l[n]>>4],o[l[n]&15]);return _},parse_hex_octets:function(l){for(var _=new Array(l.length/2),n=0;n<_.length;n++)_[n]=(t[l[2*n]]<<4)+t[l[1+2*n]];return _}}},47451:(N,P,o)=>{"use strict";var t=N.exports;window.Zmodem=t,Object.assign(t,o(36320));function h(c){if(c.aborted())throw new t.Error("aborted")}t.Browser={send_files:function(l,_,n){n||(n={});for(var s=[],d=0,u=_.length-1;u>=0;u--){var x=_[u];d+=x.size,s[u]={obj:x,name:x.name,size:x.size,mtime:new Date(x.lastModified),files_remaining:_.length-u,bytes_remaining:d}}var y=0;function b(){var A=s[y];return A?(y++,l.send_offer(A).then(function(m){return n.on_offer_response&&n.on_offer_response(A.obj,m),m===void 0?b():new Promise(function(O){var e=new FileReader;e.onerror=function(C){throw console.error("file read error",C),"File read error: "+C};var r;e.onprogress=function(C){C.target.result&&(r=new Uint8Array(C.target.result,m.get_offset()),h(l),m.send(r),n.on_progress&&n.on_progress(A.obj,m,r))},e.onload=function(C){r=new Uint8Array(C.target.result,m,r),h(l),m.end(r).then(function(){n.on_progress&&r.length&&n.on_progress(A.obj,m,r),n.on_file_complete&&n.on_file_complete(A.obj,m),O(b())})},e.readAsArrayBuffer(A.obj)})})):Promise.resolve()}return b()},save_to_disk:function(l,_){var n=new Blob(l),s=URL.createObjectURL(n),d=document.createElement("a");d.style.display="none",d.href=s,d.download=_,d.click(),setTimeout(()=>URL.revokeObjectURL(s),1e4)}}},47548:(N,P,o)=>{"use strict";const t=o(52566);var h=N.exports;Object.assign(h,o(15584),o(39786));var c;const l=16,_=4129,n=65535,s=1<<l-1;function d(){c=new Array(256);for(var y=l-8,b=0;b<256;b++){for(var A=b<<y&n,v=0;v<8;v++)(A&s)!==0?(A<<=1,A^=_):A<<=1;c[b]=A&n}}function u(y,b){return c||d(),c[b>>8&255]^(255&b)<<8^y}function x(y,b){var A;if(y.join()!==b.join())throw new h.Error("crc",b,y)}h.CRC={crc16:function(b){for(var A=b[0],v=1;v<b.length;v++)A=u(b[v],A);return A=u(0,u(0,A)),h.ENCODELIB.pack_u16_be(A)},crc32:function(b){return h.ENCODELIB.pack_u32_le(t.buf(b)>>>0)},verify16:function(b,A){return x(this.crc16(b),A)},verify32:function(b,A){try{x(this.crc32(b),A)}catch(v){throw v.input=b.slice(0),v}}}},48357:(N,P,o)=>{"use strict";var t=N.exports;Object.assign(t,o(39786),o(27637),o(3434),o(47548),o(15584));const h="*".charCodeAt(0),c="A".charCodeAt(0),l="B".charCodeAt(0),_="C".charCodeAt(0),n=[13,10],s=n.slice(0).concat([t.ZMLIB.XON]),d=[h,h,t.ZMLIB.ZDLE,l],u=[h,t.ZMLIB.ZDLE,c],x=[h,t.ZMLIB.ZDLE,_];t.Header=class{static trim_leading_garbage(E){var I=[],B,U,$=0;e:for(;E.length&&!U;){var ae=E.indexOf(h);if(ae===-1){B=!0;break e}else{if(I.push.apply(I,E.splice(0,ae)),E.length<2)break e;if(E[1]===h)if(E.length<d.length){if(E.join()===d.slice(0,E.length).join())break e}else E[2]===d[2]&&E[3]===d[3]&&(U=ne);else if(E[1]===t.ZMLIB.ZDLE){if(E.length<u.length)break e;E[2]===u[2]?U=G:E[2]===x[2]&&(U=le)}U||I.push(E.shift())}}return B&&I.push.apply(I,E.splice(0)),I}static parse(E){var I;if(E[1]===h)return I=ne(E),I&&[I,16];if(E[2]===c)return I=G(E,3),I&&[I,16];if(E[2]===_)return I=le(E),I&&[I,32];if(!(E.length<3))throw"Unrecognized/unsupported octets: "+E.join()}static build(E){var I=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),B=oe[E];if(!B)throw"No frame class \u201C"+E+"\u201D is defined!";I.shift();var U=new(B.bind.apply(B,[null].concat(I)));return U}to_hex(){var E=this._crc_bytes();return d.concat(t.ENCODELIB.octets_to_hex(E.concat(t.CRC.crc16(E))),this._hex_header_ending)}to_binary16(E){return this._to_binary(E,u,t.CRC.crc16)}to_binary32(E){return this._to_binary(E,x,t.CRC.crc32)}constructor(){this._bytes4||(this._bytes4=[0,0,0,0])}_to_binary(E,I,B){var U=this._crc_bytes(),$=I.concat(E.encode(U.concat(B(U))));return $}_crc_bytes(){return[this.TYPENUM].concat(this._bytes4)}},t.Header.prototype._hex_header_ending=s;class y extends t.Header{}const b={CANFDX:1,CANOVIO:2,CANBRK:4,CANCRY:8,CANLZW:16,CANFC32:32,ESCCTL:64,ESC8:128};function A(R){if(!b[R])throw new t.Error("Invalid ZRINIT flag: "+R);return b[R]}class v extends t.Header{constructor(E,I){super();var B=0;I||(I=0),E.forEach(function(U){B|=A(U)}),this._bytes4=[I&255,I>>8,0,B]}get_buffer_size(){return t.ENCODELIB.unpack_u16_be(this._bytes4.slice(0,2))||void 0}can_full_duplex(){return!!(this._bytes4[3]&b.CANFDX)}can_overlap_io(){return!!(this._bytes4[3]&b.CANOVIO)}can_break(){return!!(this._bytes4[3]&b.CANBRK)}can_fcs_32(){return!!(this._bytes4[3]&b.CANFC32)}escape_ctrl_chars(){return!!(this._bytes4[3]&b.ESCCTL)}escape_8th_bit(){return!!(this._bytes4[3]&b.ESC8)}}const m={ESCCTL:64,ESC8:128};function O(R){if(!m[R])throw"Invalid ZSINIT flag: "+R;return m[R]}class e extends t.Header{constructor(E,I){super();var B=0;if(E.forEach(function(U){B|=O(U)}),this._bytes4=[0,0,0,B],I){if(I.length>31)throw"Attn sequence must be <= 31 bytes";if(I.some(function(U){return U>255}))throw"Attn sequence ("+I+") must be <256";this._data=I.concat([0])}}escape_ctrl_chars(){return!!(this._bytes4[3]&m.ESCCTL)}escape_8th_bit(){return!!(this._bytes4[3]&m.ESC8)}}class r extends t.Header{constructor(E){super(),E&&(this._bytes4=E.slice())}}r.prototype._hex_header_ending=n;const a={extended:{sparse:64},transport:[void 0,"compress","encrypt","rle"],management:[void 0,"newer_or_longer","crc","append","clobber","newer","mtime_or_length","protect","rename"],conversion:[void 0,"binary","text","resume"]},C=["extended","transport","management","conversion"],T=128,M=31,D=64;class f extends t.Header{get_options(){var E={sparse:!!(this._bytes4[0]&D)},I=this._bytes4.slice(0);return C.forEach(function(B,U){if(a[B]instanceof Array)B==="management"&&(E.skip_if_absent=!!(I[U]&T),I[U]&=M),E[B]=a[B][I[U]];else for(var $ in a[B])E[$]=!!(I[U]&a[B][$]),E[$]&&(I[U]^=a[B][$]);!E[B]&&I[U]&&(E[B]="unknown:"+I[U])}),E}}class k extends t.Header{}class i extends t.Header{}class Z extends t.Header{}class F extends t.Header{}Z.prototype._hex_header_ending=n;class S extends t.Header{constructor(E){super(),this._bytes4=t.ENCODELIB.pack_u32_le(E)}get_offset(){return t.ENCODELIB.unpack_u32_le(this._bytes4)}}class Q extends S{}class W extends S{}class _e extends S{}const j=[[y,"ZRQINIT"],[v,"ZRINIT"],[e,"ZSINIT"],[r,"ZACK"],[f,"ZFILE"],[k,"ZSKIP"],void 0,[i,"ZABORT"],[Z,"ZFIN"],[Q,"ZRPOS"],[W,"ZDATA"],[_e,"ZEOF"],[F,"ZFERR"],void 0,void 0,void 0,void 0,void 0,void 0,void 0];for(var oe={},J=0;J<j.length;J++)!j[J]||(oe[j[J][1]]=j[J][0],Object.assign(j[J][0].prototype,{TYPENUM:J,NAME:j[J][1]}));const ce=[y,v,e,r,f,k,"ZNAK",i,Z,Q,W,_e,F,"ZCRC","ZCHALLENGE","ZCOMPL","ZCAN","ZFREECNT","ZCOMMAND","ZSTDERR"];function q(R){var E=ce[R];if(typeof E=="string")throw"Received unsupported header: "+E;return X(E)}function X(R){return R.prototype instanceof S?new R(0):new R([])}function G(R){var E=t.ZDLE.splice(R,u.length,7);return E&&ie(E)}function ie(R){t.CRC.verify16(R.slice(0,5),R.slice(5));var E=R[0],I=q(E);return I._bytes4=R.slice(1,5),I}function le(R){var E=t.ZDLE.splice(R,x.length,9);if(!!E){t.CRC.verify32(E.slice(0,5),E.slice(5));var I=E[0],B=q(I);return B._bytes4=E.slice(1,5),B}}function ne(R){var E=R.indexOf(138);E===-1&&(E=R.indexOf(10));var I,B;if(E===-1){R.length>11&&(I="Invalid hex header - no LF detected within 12 bytes!");return}else if(B=R.splice(0,E),R.shift(),B.length===19){var U=B.pop();U!==13&&U!==141&&(I="Invalid hex header: (CR/)LF doesn\u2019t have CR!")}else B.length!==18&&(I="Invalid hex header: invalid number of bytes before LF!");if(I)throw I+=" ("+B.length+" bytes: "+B.join()+")",I;B.splice(0,4);var $=t.ENCODELIB.parse_hex_octets(B);return ie($)}t.Header.parse_hex=ne},52566:(N,P)=>{var o;(function(t){t(typeof DO_NOT_EXPORT_CRC=="undefined"?P:o={})})(function(t){t.version="1.2.2";function h(){for(var f=0,k=new Array(256),i=0;i!=256;++i)f=i,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,k[i]=f;return typeof Int32Array!="undefined"?new Int32Array(k):k}var c=h();function l(f){var k=0,i=0,Z=0,F=typeof Int32Array!="undefined"?new Int32Array(4096):new Array(4096);for(Z=0;Z!=256;++Z)F[Z]=f[Z];for(Z=0;Z!=256;++Z)for(i=f[Z],k=256+Z;k<4096;k+=256)i=F[k]=i>>>8^f[i&255];var S=[];for(Z=1;Z!=16;++Z)S[Z-1]=typeof Int32Array!="undefined"?F.subarray(Z*256,Z*256+256):F.slice(Z*256,Z*256+256);return S}var _=l(c),n=_[0],s=_[1],d=_[2],u=_[3],x=_[4],y=_[5],b=_[6],A=_[7],v=_[8],m=_[9],O=_[10],e=_[11],r=_[12],a=_[13],C=_[14];function T(f,k){for(var i=k^-1,Z=0,F=f.length;Z<F;)i=i>>>8^c[(i^f.charCodeAt(Z++))&255];return~i}function M(f,k){for(var i=k^-1,Z=f.length-15,F=0;F<Z;)i=C[f[F++]^i&255]^a[f[F++]^i>>8&255]^r[f[F++]^i>>16&255]^e[f[F++]^i>>>24]^O[f[F++]]^m[f[F++]]^v[f[F++]]^A[f[F++]]^b[f[F++]]^y[f[F++]]^x[f[F++]]^u[f[F++]]^d[f[F++]]^s[f[F++]]^n[f[F++]]^c[f[F++]];for(Z+=15;F<Z;)i=i>>>8^c[(i^f[F++])&255];return~i}function D(f,k){for(var i=k^-1,Z=0,F=f.length,S=0,Q=0;Z<F;)S=f.charCodeAt(Z++),S<128?i=i>>>8^c[(i^S)&255]:S<2048?(i=i>>>8^c[(i^(192|S>>6&31))&255],i=i>>>8^c[(i^(128|S&63))&255]):S>=55296&&S<57344?(S=(S&1023)+64,Q=f.charCodeAt(Z++)&1023,i=i>>>8^c[(i^(240|S>>8&7))&255],i=i>>>8^c[(i^(128|S>>2&63))&255],i=i>>>8^c[(i^(128|Q>>6&15|(S&3)<<4))&255],i=i>>>8^c[(i^(128|Q&63))&255]):(i=i>>>8^c[(i^(224|S>>12&15))&255],i=i>>>8^c[(i^(128|S>>6&63))&255],i=i>>>8^c[(i^(128|S&63))&255]);return~i}t.table=c,t.bstr=T,t.buf=M,t.str=D})},53827:(N,P,o)=>{var t=o(1779);N.exports=function(h,c){return h=h||{},Object.keys(c).forEach(function(l){typeof h[l]=="undefined"&&(h[l]=t(c[l]))}),h}},58134:(N,P,o)=>{"use strict";var t=N.exports;t.DEBUG=!1,Object.assign(t,o(39786),o(5275),o(27637),o(3434),o(48357),o(85360),o(5555),o(15584));const h=5e3,c=["CANFDX","CANOVIO","CANFC32"],l=!0,_="spool_uint8array",n=8192,s=8,d=[79,79],u=t.ZMLIB.ABORT_SEQUENCE;class x{constructor(){this._on_evt={},this._evt_once_index={}}_Add_event(e){this._on_evt[e]=[],this._evt_once_index[e]=[]}_get_evt_queue(e){if(!this._on_evt[e])throw"Bad event: "+e;return this._on_evt[e]}on(e,r){var a=this._get_evt_queue(e);return a.push(r),this}off(e,r){var a=this._get_evt_queue(e);if(r){var C=a.indexOf(r);if(C===-1)throw"\u201C"+r+"\u201D is not in the \u201C"+e+"\u201D queue.";a.splice(C,1)}else a.pop();return this}_Happen(e){var r=this._get_evt_queue(e),a=Array.apply(null,arguments);a.shift();var C=this;return r.forEach(function(T){T.apply(C,a)}),r.length}}t.Session=class extends x{static parse(e){var r;try{r=t.Header.parse_hex(e)}catch(a){return}if(!!r)switch(r.NAME){case"ZRQINIT":return new t.Session.Receive;case"ZRINIT":return new t.Session.Send(r)}}set_sender(e){return this._sender=e,this}has_ended(){return this._has_ended()}consume(e){if(this._before_consume(e),this._aborted)throw new t.Error("already_aborted");!e.length||(this._strip_and_enqueue_input(e),this._check_for_abort_sequence(e)||this._consume_first())}aborted(){return!!this._aborted}constructor(){super(),this._config={},this._input_buffer=[],this._Add_event("receive"),this._Add_event("garbage"),this._Add_event("session_end")}get_role(){return this.type}_trim_leading_garbage_until_header(){var e=t.Header.trim_leading_garbage(this._input_buffer);e.length&&this._Happen("garbage",e)===0&&console.debug("Garbage: ",String.fromCharCode.apply(String,e),e)}_parse_and_consume_header(){this._trim_leading_garbage_until_header();var e=t.Header.parse(this._input_buffer);if(!!e)return t.DEBUG&&this._log_header("RECEIVED HEADER",e[0]),this._consume_header(e[0]),this._last_header_name=e[0].NAME,this._last_header_crc=e[1],e[0]}_log_header(e,r){console.debug(this.type,e,r.NAME,r._bytes4.join())}_consume_header(e){this._on_receive(e);var r=this._next_header_handler&&this._next_header_handler[e.NAME];if(!r)throw console.error("Unhandled header!",e,this._next_header_handler),new t.Error("Unhandled header: "+e.NAME);this._next_header_handler=null,r.call(this,e)}_check_for_abort_sequence(){var e=t.ZMLIB.find_subarray(this._input_buffer,u);if(e!==-1)throw this._input_buffer.splice(0,e+u.length),this._aborted=!0,this._on_session_end(),new t.Error("peer_aborted")}_send_header(e){if(!this._sender)throw"Need sender!";var r=Array.apply(null,arguments),a=this._create_header_bytes(r);t.DEBUG&&this._log_header("SENDING HEADER",a[1]),this._sender(a[0]),this._last_sent_header=a[1]}_create_header_bytes(e){var r=t.Header.build.apply(t.Header,e),a=this._get_header_formatter(e[0]);return[r[a](this._zencoder),r]}_strip_and_enqueue_input(e){t.ZMLIB.strip_ignored_bytes(e),this._input_buffer.push.apply(this._input_buffer,e)}abort(){this._sender(u.concat([s,s,s,s,s])),this._aborted=!0,this._sender=function(){throw new t.Error("already_aborted")},this._on_session_end()}_on_session_end(){this._Happen("session_end")}_on_receive(e){this._Happen("receive",e)}_before_consume(){}};function y(O){return t.ZMLIB.find_subarray(O,d)===0?O.splice(0,d.length):O[0]===d[d.length-1]&&O.splice(0,1),O}t.Session.Receive=class extends t.Session{constructor(){super(),this._Add_event("offer"),this._Add_event("data_in"),this._Add_event("file_end")}_before_consume(e){if(this._bytes_after_OO)throw"PROTOCOL: Session is completed!";this._bytes_being_consumed=e}get_trailing_bytes(){if(this._aborted)return[];if(!this._bytes_after_OO)throw"PROTOCOL: Session is not completed!";return this._bytes_after_OO.slice(0)}_has_ended(){return this.aborted()||!!this._bytes_after_OO}_get_header_formatter(){return"to_hex"}_parse_and_consume_subpacket(){var e;this._last_header_crc===16?e="parse16":e="parse32";var r=t.Subpacket[e](this._input_buffer);return r&&(t.DEBUG&&console.debug(this.type,"RECEIVED SUBPACKET",r),this._consume_data(r),r.frame_end()&&(this._next_subpacket_handler=null)),r}_consume_first(){if(this._got_ZFIN){if(this._input_buffer.length<2)return;this._bytes_after_OO=y(this._bytes_being_consumed.slice(0)),this._on_session_end();return}var e;do this._next_subpacket_handler?e=this._parse_and_consume_subpacket():e=this._parse_and_consume_header();while(e&&this._input_buffer.length)}_consume_data(e){if(this._on_receive(e),!this._next_subpacket_handler)throw"PROTOCOL: Received unexpected data packet after "+this._last_header_name+" header: "+e.get_payload().join();this._next_subpacket_handler.call(this,e)}_octets_to_string(e){return this._textdecoder||(this._textdecoder=new t.Text.Decoder),this._textdecoder.decode(new Uint8Array(e))}_consume_ZFILE_data(e,r){if(this._file_info)throw"PROTOCOL: second ZFILE data subpacket received";var a=r.get_payload(),C=a.indexOf(0),T=this._octets_to_string(a.slice(0,C)),M=this._octets_to_string(a.slice(1+C)).split(" "),D=M[1]&&parseInt(M[1],8)||void 0;D&&(D=new Date(D*1e3)),this._file_info={name:T,size:M[0]?parseInt(M[0],10):null,mtime:D||null,mode:M[2]&&parseInt(M[2],8)||null,serial:M[3]&&parseInt(M[3],10)||null,files_remaining:M[4]?parseInt(M[4],10):null,bytes_remaining:M[5]?parseInt(M[5],10):null};var f=new v(e.get_options(),this._file_info,this._accept.bind(this),this._skip.bind(this));this._current_transfer=f}_consume_ZDATA_data(e){if(!this._accepted_offer)throw"PROTOCOL: Received data without accepting!";if(!this._offset_ok){console.warn("offset not ok!"),_send_ZRPOS();return}this._file_offset+=e.get_payload().length,this._on_data_in(e),e.ack_expected()&&!e.frame_end()&&this._send_header("ZACK",t.ENCODELIB.pack_u32_le(this._file_offset))}_make_promise_for_between_files(){var e=this;return new Promise(function(r){var a={ZFILE:function(C){this._next_subpacket_handler=function(T){this._next_subpacket_handler=null,this._consume_ZFILE_data(C,T),this._Happen("offer",this._current_transfer),r(this._current_transfer)}},ZSINIT:function(C){e._next_subpacket_handler=function(T){e._next_subpacket_handler=null,e._consume_ZSINIT_data(T),e._send_header("ZACK"),e._next_header_handler=a}},ZFIN:function(){this._consume_ZFIN(),r()}};e._next_header_handler=a})}_consume_ZSINIT_data(e){this._attn=e.get_payload()}start(){if(this._started)throw"Already started!";this._started=!0;var e=this._make_promise_for_between_files();return this._send_ZRINIT(),e}_accept(e){this._accepted_offer=!0,this._file_offset=e||0;var r=this,a=new Promise(function(C){var T;r._next_header_handler={ZDATA:function(D){this._consume_ZDATA(D),this._next_subpacket_handler=this._consume_ZDATA_data,this._next_header_handler={ZEOF:function(k){this._consume_ZEOF(k),this._next_subpacket_handler=null,this._make_promise_for_between_files(),C(),this._send_ZRINIT()}}}}});return this._send_ZRPOS(),a}_skip(){var e=this._make_promise_for_between_files();if(this._accepted_offer){if(!this._current_transfer)return;var r=function(){this._accepted_offer=!1,this._next_subpacket_handler=null,this._make_promise_for_between_files()}.bind(this);Object.assign(this._next_header_handler,{ZEOF:r,ZDATA:function(){r(),this._next_header_handler.ZEOF=r}.bind(this)})}return this._file_info=null,this._send_header("ZSKIP"),e}_send_ZRINIT(){this._send_header("ZRINIT",c)}_consume_ZFIN(){this._got_ZFIN=!0,this._send_header("ZFIN")}_consume_ZEOF(e){if(this._file_offset!==e.get_offset())throw"ZEOF offset mismatch; unimplemented (local: "+this._file_offset+"; ZEOF: "+e.get_offset()+")";this._on_file_end(),this._file_info=null,this._current_transfer=null}_consume_ZDATA(e){if(this._file_offset===e.get_offset())this._offset_ok=!0;else throw"Error correction is unimplemented."}_send_ZRPOS(){this._send_header("ZRPOS",this._file_offset)}_on_file_end(){this._Happen("file_end"),this._current_transfer&&(this._current_transfer._Happen("complete"),this._current_transfer=null)}_on_data_in(e){this._Happen("data_in",e),this._current_transfer&&this._current_transfer._Happen("input",e.get_payload())}},Object.assign(t.Session.Receive.prototype,{type:"receive"});var b={get_details:function(){return Object.assign({},this._file_info)},get_options:function(){return Object.assign({},this._zfile_opts)},get_offset:function(){return this._file_offset}};class A{constructor(e,r,a,C){this._file_info=e,this._file_offset=r||0,this._send=a,this._end=C}send(e){this._send(e),this._file_offset+=e.length}end(e){var r=this._end(e||[]);return e&&(this._file_offset+=e.length),r}}Object.assign(A.prototype,b);class v extends x{constructor(e,r,a,C){super(),this._zfile_opts=e,this._file_info=r,this._accept_func=a,this._skip_func=C,this._Add_event("input"),this._Add_event("complete"),this.on("input",this._input_handler)}_verify_not_skipped(){if(this._skipped)throw new t.Error("Already skipped!")}skip(){return this._verify_not_skipped(),this._skipped=!0,this._skip_func.apply(this,arguments)}accept(e){if(this._verify_not_skipped(),this._accepted)throw new t.Error("Already accepted!");switch(this._accepted=!0,e||(e={}),this._file_offset=e.offset||0,e.on_input){case null:case void 0:case"spool_array":case _:this._spool=[];break;default:if(typeof e.on_input!="function")throw"Invalid \u201Con_input\u201D: "+e.on_input}return this._input_handler_mode=e.on_input||_,this._accept_func(this._file_offset).then(this._get_spool.bind(this))}_input_handler(e){if(this._file_offset+=e.length,typeof this._input_handler_mode=="function")this._input_handler_mode(e);else{if(this._input_handler_mode===_)e=new Uint8Array(e);else if(this._input_handler_mode!=="spool_array")throw new t.Error("WTF?? _input_handler_mode = "+this._input_handler_mode);this._spool.push(e)}}_get_spool(){return this._spool}}Object.assign(v.prototype,b);const m={ZFILE:!0,ZDATA:!0};t.Session.Send=class extends t.Session{constructor(e){if(super(),e){if(e.NAME!=="ZRINIT")throw"First header should be ZRINIT, not "+e.NAME}else throw"Need first header!";this._last_header_name="ZRINIT",this._subpacket_encode_func="encode16",this._zencoder=new t.ZDLE,this._consume_ZRINIT(e),this._file_offset=0;var r=0;this._start_keepalive_on_set_sender=!0}set_sender(e){return super.set_sender(e),this._start_keepalive_on_set_sender&&(this._start_keepalive_on_set_sender=!1,this._start_keepalive()),this}_get_header_formatter(e){return m[e]?"to_binary16":"to_hex"}_start_keepalive(){if(!this._keepalive_promise){var e=this;this._keepalive_promise=new Promise(function(r){e._keepalive_timeout=setTimeout(r,h)}).then(function(){e._next_header_handler={ZACK:function(){e._got_ZSINIT_ZACK=!0}},e._send_ZSINIT(),e._keepalive_promise=null,e._start_keepalive()})}}_stop_keepalive(){this._keepalive_promise&&(clearTimeout(this._keepalive_timeout),this._keep_alive_promise=null)}_send_ZSINIT(){var e=[];this._zencoder.escapes_ctrl_chars()&&e.push("ESCCTL"),this._send_header_and_data(["ZSINIT",e],[0],"end_ack")}_consume_ZRINIT(e){if(this._last_ZRINIT=e,e.get_buffer_size())throw"Buffer size ("+e.get_buffer_size()+") is unsupported!";if(!e.can_full_duplex())throw"Half-duplex I/O is unsupported!";if(!e.can_overlap_io())throw"Non-overlap I/O is unsupported!";if(e.escape_8th_bit())throw"8-bit escaping is unsupported!";l?(this._zencoder.set_escape_ctrl_chars(!0),e.escape_ctrl_chars()||console.debug("Peer didn\u2019t request escape of all control characters. Will send ZSINIT to force recognition of escaped control characters.")):this._zencoder.set_escape_ctrl_chars(e.escape_ctrl_chars())}_ensure_receiver_escapes_ctrl_chars(){var e,r=!this._last_ZRINIT.escape_ctrl_chars()&&!this._got_ZSINIT_ZACK;if(r){var a=this;e=new Promise(function(C){a._next_header_handler={ZACK:T=>{C()}},a._send_ZSINIT()})}else e=Promise.resolve();return e}_convert_params_to_offer_payload_array(e){e=t.Validation.offer_parameters(e);var r=e.name+"\0",a=[(e.size||0).toString(10),e.mtime?e.mtime.toString(8):"0",e.mode?(32768|e.mode).toString(8):"0","0"];return e.files_remaining&&(a.push(e.files_remaining),e.bytes_remaining&&a.push(e.bytes_remaining)),r+=a.join(" "),this._string_to_octets(r)}send_offer(e){if(t.DEBUG&&console.debug("SENDING OFFER",e),!e)throw"need file params!";if(this._sending_file)throw"Already sending file!";var r=this._convert_params_to_offer_payload_array(e);this._stop_keepalive();var a=this;function C(){a._next_header_handler={ZRPOS:function(M){t.DEBUG&&console.warn("Mid-transfer ZRPOS \u2026 implementation error?"),C()}}}var T=function(){var M=new Promise(function(D){a._next_header_handler={ZSKIP:function(){a._start_keepalive(),D()},ZRPOS:function(f){a._sending_file=!0,C(),D(new A(e,f.get_offset(),a._send_interim_file_piece.bind(a),a._end_file.bind(a)))}}});return a._send_header_and_data(["ZFILE"],r,"end_ack"),delete a._sent_ZDATA,M};return l?this._ensure_receiver_escapes_ctrl_chars().then(T):T()}_send_header_and_data(e,r,a){var C=this._create_header_bytes(e),T=this._build_subpacket_bytes(r,a);C[0].push.apply(C[0],T),t.DEBUG&&(this._log_header("SENDING HEADER",C[1]),console.debug(this.type,"-- HEADER PAYLOAD:",a,T.length)),this._sender(C[0]),this._last_sent_header=C[1]}_build_subpacket_bytes(e,r){var a=t.Subpacket.build(e,r);return a[this._subpacket_encode_func](this._zencoder)}_build_and_send_subpacket(e,r){this._sender(this._build_subpacket_bytes(e,r))}_string_to_octets(e){this._textencoder||(this._textencoder=new t.Text.Encoder);var r=this._textencoder.encode(e);return Array.prototype.slice.call(r)}_send_interim_file_piece(e){return this._send_file_part(e,"no_end_no_ack"),Promise.resolve()}_ensure_we_are_sending(){if(!this._sending_file)throw"Not sending a file currently!"}_end_file(e){this._ensure_we_are_sending(),this._send_file_part(e,"end_no_ack");var r=this,a=new Promise(function(C){r._sending_file=!1,r._prepare_to_receive_ZRINIT(C)});return this._send_header("ZEOF",this._file_offset),this._file_offset=0,a}_prepare_to_receive_ZRINIT(e){this._next_header_handler={ZRINIT:function(r){this._consume_ZRINIT(r),e&&e()}}}close(){var e=this._last_header_name==="ZRINIT";if(e||(e=this._last_header_name==="ZSKIP"),e||(e=this._last_sent_header.name==="ZSINIT"&&this._last_header_name==="ZACK"),!e)throw"Can\u2019t close; last received header was \u201C"+this._last_header_name+"\u201D";var r=this,a=new Promise(function(C,T){r._next_header_handler={ZFIN:function(){r._sender(d),r._sent_OO=!0,r._on_session_end(),C()}}});return this._send_header("ZFIN"),a}_has_ended(){return this.aborted()||!!this._sent_OO}_send_file_part(e,r){this._sent_ZDATA||(this._send_header("ZDATA",this._file_offset),this._sent_ZDATA=!0);for(var a=0,C=e.length;;){var T=Math.min(a+n,C)-a,M=T+a>=C,D=e.slice(a,a+T);if(D instanceof Array||(D=Array.prototype.slice.call(D)),this._build_and_send_subpacket(D,M?r:"no_end_no_ack"),this._file_offset+=T,a+=T,a>=C)break}}_consume_first(){if(!this._parse_and_consume_header()&&this._input_buffer.join()==="67")throw"Receiver has fallen back to YMODEM."}_on_session_end(){this._stop_keepalive(),super._on_session_end()}},Object.assign(t.Session.Send.prototype,{type:"send"})},68599:N=>{N.exports=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]]},68683:(N,P,o)=>{"use strict";var t=N.exports;Object.assign(t,o(3434),o(58134));const h=20,c=21,l=[42,42,24,66,48],_=["to_terminal","on_detect","on_retract","sender"],n=42;class s{constructor(u,x,y,b){this._confirmer=x,this._denier=y,this._is_valid=b,this._session_type=u}confirm(){return this._confirmer.apply(this,arguments)}deny(){return this._denier.apply(this,arguments)}is_valid(){return this._is_valid.apply(this,arguments)}get_session_role(){return this._session_type}}t.Sentry=class{constructor(u){if(!u)throw"Need options!";var x=this;_.forEach(function(y){if(!u[y])throw"Need \u201C"+y+"\u201D!";x["_"+y]=u[y]}),this._cache=[]}_after_session_end(){this._zsession=null}consume(u){if(u instanceof Array||(u=Array.prototype.slice.call(new Uint8Array(u))),this._zsession){var x=this._zsession;if(x.consume(u),x.has_ended())x.type==="receive"?u=x.get_trailing_bytes():u=[];else return}var y=this._parse(u),b=u;if(y){let m=function(){return A._parsed_session===y},O=function(){if(!this.is_valid())throw"Stale ZMODEM session!";return y.on("garbage",A._to_terminal),y.on("session_end",A._after_session_end.bind(A)),y.set_sender(A._sender),delete A._parsed_session,A._zsession=y},e=function(){this.is_valid()};!!this._parsed_session&&(this._parsed_session.type===y.type&&(b=[]),this._on_retract()),this._parsed_session=y;var A=this;this._on_detect(new s(y.type,O,this._send_abort.bind(this),m))}else{var v=this._parsed_session;this._parsed_session=null,v&&(b.length===1&&b[0]===67&&this._send_abort(),this._on_retract())}this._to_terminal(b)}get_confirmed_session(){return this._zsession||null}_send_abort(){this._sender(t.ZMLIB.ABORT_SEQUENCE)}_parse(u){var x=this._cache;for(x.push.apply(x,u);;){let y=t.ZMLIB.find_subarray(x,l);if(y===-1)break;let b=x.splice(0,y),A;try{A=t.Session.parse(x)}catch(v){}if(!A)break;return x.length===1&&x[0]===t.ZMLIB.XON&&x.shift(),x.length?null:A}return x.splice(c),null}}},74633:(N,P,o)=>{"use strict";var t=o(53827),h=o(68599),c={nul:0,control:0};N.exports=function(d){return l(d,c)},N.exports.config=function(s){return s=t(s||{},c),function(u){return l(u,s)}};function l(s,d){if(typeof s!="string")return _(s,d);for(var u=0,x=0;x<s.length;x++){var y=_(s.charCodeAt(x),d);if(y<0)return-1;u+=y}return u}function _(s,d){return s===0?d.nul:s<32||s>=127&&s<160?d.control:n(s)?0:1+(s>=4352&&(s<=4447||s==9001||s==9002||s>=11904&&s<=42191&&s!=12351||s>=44032&&s<=55203||s>=63744&&s<=64255||s>=65040&&s<=65049||s>=65072&&s<=65135||s>=65280&&s<=65376||s>=65504&&s<=65510||s>=131072&&s<=196605||s>=196608&&s<=262141))}function n(s){var d=0,u=h.length-1,x;if(s<h[0][0]||s>h[u][1])return!1;for(;u>=d;)if(x=Math.floor((d+u)/2),s>h[x][1])d=x+1;else if(s<h[x][0])u=x-1;else return!0;return!1}},85360:(N,P,o)=>{"use strict";var t=N.exports;Object.assign(t,o(47548),o(27637),o(3434),o(15584));const h=104,c=105,l=106,_=107;var n;t.Subpacket=class ue{static build(v,m){var O=n[m];if(!O)throw"No subpacket type \u201C"+m+"\u201D is defined! Try one of: "+Object.keys(n).join(", ");return new O(v)}encode16(v){return this._encode(v,t.CRC.crc16)}encode32(v){return this._encode(v,t.CRC.crc32)}get_payload(){return this._payload}static parse16(v){return ue._parse(v,2)}static parse32(v){return ue._parse(v,4)}constructor(v){this._payload=v}_encode(v,m){return v.encode(this._payload.slice(0)).concat([t.ZMLIB.ZDLE,this._frameend_num],v.encode(m(this._payload.concat(this._frameend_num))))}static _parse(v,m){for(var O,e,r={104:u,105:y,106:b,107:x},a=0;a<v.length;){if(a=v.indexOf(t.ZMLIB.ZDLE,a),a===-1)return;var C=v[a+1];if(e=r[C],e){O=a+1;break}a++}if(!!e){var T=v[O];if(v[O-1]!==t.ZMLIB.ZDLE)throw"Byte before frame end should be ZDLE, not "+v[O-1];var M=v.splice(0,O-1),D=t.ZDLE.splice(v,2,m);if(!D){v.unshift.apply(v,M);return}var f=t.ZDLE.decode(M);return t.CRC[m===2?"verify16":"verify32"](f.concat([T]),D),new e(f,D)}}};class s extends t.Subpacket{frame_end(){return!0}}class d extends t.Subpacket{frame_end(){return!1}}class u extends s{ack_expected(){return!1}}u.prototype._frameend_num=h;class x extends s{ack_expected(){return!0}}x.prototype._frameend_num=_;class y extends d{ack_expected(){return!1}}y.prototype._frameend_num=c;class b extends d{ack_expected(){return!0}}b.prototype._frameend_num=l,n={end_no_ack:u,end_ack:x,no_end_no_ack:y,no_end_ack:b}}}]);
