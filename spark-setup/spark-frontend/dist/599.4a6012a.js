"use strict";(self.webpackChunkspark=self.webpackChunkspark||[]).push([[599,213,573,921],{86010:(x,g,e)=>{e.r(g),e.d(g,{default:()=>R});function n(E){var c,v,d="";if(typeof E=="string"||typeof E=="number")d+=E;else if(typeof E=="object")if(Array.isArray(E))for(c=0;c<E.length;c++)E[c]&&(v=n(E[c]))&&(d&&(d+=" "),d+=v);else for(c in E)E[c]&&(d&&(d+=" "),d+=c);return d}function R(){for(var E=0,c,v,d="";E<arguments.length;)(c=arguments[E++])&&(v=n(c))&&(d&&(d+=" "),d+=v);return d}},78791:(x,g,e)=>{e.d(g,{Z:()=>d});var n=e(8081),R=e.n(n),E=e(23645),c=e.n(E),v=c()(R());v.push([x.id,`a{user-select:none}.ant-table-body{max-height:300px;min-height:300px}.ant-breadcrumb{overflow-x:hidden;white-space:nowrap}.ant-pro-table-list-toolbar{overflow:hidden;-ms-overflow-style:none;scrollbar-width:none}.ant-pro-table-list-toolbar::-webkit-scrollbar{display:none}.editor-modal,.editor-modal>.ant-modal-content{top:0;margin:0;padding:0;height:100%;width:100%!important;max-width:100%!important}.editor-modal>.ant-modal-content>.ant-modal-body{height:calc(100% - 110px)}.file-row{user-select:none;cursor:pointer}
`,""]);const d=v},61780:(x,g,e)=>{e.r(g),e.d(g,{default:()=>Le});var n=e(67294),R=e(97409),E=e(73701),c=e(19650),v=e(24565),d=e(50146),T=e(48086),Z=e(71577),B=e(59667),L=e(81027),h=e(27484),W=e.n(h),l=e(37240),u=e(27865),P=e(1870),O=e(59879),F=e(1413),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const j=I;var X=e(27029),_=function(a,s){return n.createElement(X.Z,(0,F.Z)((0,F.Z)({},a),{},{ref:s,icon:j}))};_.displayName="UploadOutlined";const A=n.forwardRef(_);var Y=e(80129),b=e.n(Y),U=e(47181),ee=e(20852),K=e(53239),S=e.n(K),te=e(26213),me=Object.defineProperty,ae=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,oe=(r,a,s)=>a in r?me(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s,_e=(r,a)=>{for(var s in a||(a={}))Pe.call(a,s)&&oe(r,s,a[s]);if(ae)for(var s of ae(a))Oe.call(a,s)&&oe(r,s,a[s]);return r},Re=(r,a,s)=>new Promise((M,D)=>{var m=C=>{try{$(s.next(C))}catch(w){D(w)}},y=C=>{try{$(s.throw(C))}catch(w){D(w)}},$=C=>C.done?M(C.value):Promise.resolve(C.value).then(m,y);$((s=s.apply(r,a)).next())});let k=null;const ve=S().require("ace/ext/modelist");function he(r){k===null?Promise.all([e.e(981),e.e(89),e.e(109),e.e(825)]).then(e.bind(e,50847)).then(a=>{k=a.default,r()}):r()}let p=!1,N="",V=[];function ge(r){const[a,s]=(0,n.useState)("/"),[M,D]=(0,n.useState)(""),[m,y]=(0,n.useState)(!1),[$,C]=(0,n.useState)(!0),[w,q]=(0,n.useState)(!1),[se,re]=(0,n.useState)(""),[ye,ie]=(0,n.useState)(""),[G,de]=(0,n.useState)([]),De=[{key:"Name",title:l.ZP.t("EXPLORER.FILE_NAME"),dataIndex:"name",ellipsis:!0,width:180},{key:"Size",title:l.ZP.t("EXPLORER.FILE_SIZE"),dataIndex:"size",ellipsis:!0,width:60,renderText:(t,o)=>o.type===0||o.type===2?(0,L.BU)(t):"-"},{key:"Time",title:l.ZP.t("EXPLORER.DATE_MODIFIED"),dataIndex:"time",ellipsis:!0,width:100,renderText:(t,o)=>o.type===0?W().unix(t).format(l.ZP.t("EXPLORER.DATE_TIME_FORMAT")):"-"},{key:"Option",width:120,title:"",dataIndex:"name",valueType:"option",ellipsis:!0,render:(t,o)=>Me(o)}],Te={show:!0,search:!0,reload:!1,density:!1,setting:!1},z=(0,n.useRef)(),Ae=(0,n.useMemo)(()=>(0,u.i)({height:300,vid:"file-table"}),[]),Ce=()=>n.createElement(c.Z,{size:16},n.createElement(v.Z,{title:l.ZP.t("EXPLORER.DOWNLOAD_MULTI_CONFIRM"),onConfirm:()=>le(G)},n.createElement("a",null,l.ZP.t("EXPLORER.DOWNLOAD"))),n.createElement(v.Z,{title:l.ZP.t("EXPLORER.DELETE_MULTI_CONFIRM"),onConfirm:()=>ce(G)},n.createElement("a",null,l.ZP.t("EXPLORER.DELETE"))));(0,n.useEffect)(()=>{r.device&&(p=r.device.os==="windows",N="/",s("/")),r.open&&(V=[],y(!1))},[r.device,r.open]);function Me(t){let o=[{key:"editAsText",name:l.ZP.t("EXPLORER.EDIT_AS_TEXT")},{key:"delete",name:l.ZP.t("EXPLORER.DELETE")}];if(t.type===1)o.shift();else if(t.type===2)return[];return t.name===".."?[]:[n.createElement("a",{key:"download",onClick:()=>le(t.name)},l.ZP.t("EXPLORER.DOWNLOAD")),n.createElement(R.Z,{key:"more",onSelect:i=>pe(i,t),menus:o})]}function pe(t,o){switch(t){case"delete":let i=l.ZP.t("EXPLORER.DELETE_CONFIRM");o.type===0?i=i.replace("{0}",l.ZP.t("EXPLORER.FILE")):i=i.replace("{0}",l.ZP.t("EXPLORER.FOLDER")),d.Z.confirm({icon:n.createElement(P.Z,null),content:i,onOk:ce.bind(null,o.name)});break;case"editAsText":ue(o)}}function Ie(t){const o=p?"\\":"/";if(t.name===".."){ne(Ee(N));return}if(t.type!==0){if(p&&(a==="/"||a==="\\"||a.length===0)){ne(t.name+o);return}ne(a+t.name+o);return}const i=t.name.split(".").pop().toLowerCase();if(["jpg","jpeg","png","gif","bmp"].includes(i)&&t.size<=2<<22){Ue(t);return}if(t.size<=2<<20){const Q=ve.getModeForPath(t.name);if(Q&&Q.extRe.test(t.name)){ue(t);return}}le(t.name)}function Ue(t){y(!0),(0,L.WY)("/api/device/file/get",{device:r.device.id,files:a+t.name},{},{responseType:"blob",timeout:1e4}).then(o=>{o.status===200&&(M.length>0&&URL.revokeObjectURL(M),D(URL.createObjectURL(o.data)))}).catch(L.qS).finally(()=>{y(!1)})}function ue(t){if(t.size>2<<20){T.ZP.warn(l.ZP.t("EXPLORER.FILE_TOO_LARGE"));return}se||(y(!0),(0,L.WY)("/api/device/file/text",{device:r.device.id,file:a+t.name},{},{responseType:"blob",timeout:7e3}).then(o=>{o.status===200&&o.data.text().then(i=>{he(()=>{ie(i),C(!1),re(t.name)})})}).catch(L.qS).finally(()=>{y(!1)}))}function ne(t){m||(N=t,s(t),z.current.reload())}function Ee(t){let o=p?"\\":"/",f=t.substring(0,t.length-1).split(o);return f.pop(),f.length===0?"/":f.join(o)+o}function Se(){if((a==="/"||a==="\\"||a.length===0)&&p){T.ZP.error(l.ZP.t("EXPLORER.UPLOAD_INVALID_PATH"));return}document.getElementById("file-uploader").click()}function Ze(t){let o=t.target.files[0];if(o!==void 0){t.target.value=null;{let i=!1;for(let f=0;f<V.length;f++)if(V[f].type===0&&V[f].name===o.name){i=!0;break}i?d.Z.confirm({autoFocusButton:"cancel",content:l.ZP.t("EXPLORER.OVERWRITE_CONFIRM").replace("{0}",o.name),okText:l.ZP.t("EXPLORER.OVERWRITE"),onOk:()=>{q(o)},okButtonProps:{danger:!0}}):(q(o),C(!1))}}}function Be(){z.current.reload(),q(!1),C(!0)}function We(){q(!1),C(!0)}function le(t){if((a==="/"||a==="\\"||a.length===0)&&p){T.ZP.error(l.ZP.t("EXPLORER.DOWNLOAD_VOLUMES_ERROR"));return}let o=[];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]!==".."&&o.push(a+t[i]);else o=a+t;(0,L.v_)(location.origin+location.pathname+"api/device/file/get",{files:o,device:r.device.id})}function ce(t){if((a==="/"||a==="\\"||a.length===0)&&p){T.ZP.error(l.ZP.t("EXPLORER.DELETE_INVALID_PATH"));return}let o=[];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]!==".."&&o.push(a+t[i]);else o=a+t;(0,L.WY)("/api/device/file/remove",{files:o,device:r.device.id},{},{transformRequest:[i=>b().stringify(i,{indices:!1})]}).then(i=>{i.data.code===0&&(T.ZP.success(l.ZP.t("EXPLORER.DELETE_SUCCESS")),z.current.reload())})}function Xe(t){return Re(this,null,function*(){var o;yield(0,L.pQ)(300);let i=yield(0,L.WY)("/api/device/file/list",{path:N,device:r.device.id});de([]),y(!1);let f=i.data;if(f.code===0){let Q=!1;if(t.keyword=(o=t.keyword)!=null?o:"",t.keyword.length>0){let H=t.keyword.toLowerCase(),J=H.replace(/[.+^${}()|[\]\\]/g,"\\$&"),Ke=new RegExp(`^${J.replace(/\*/g,".*").replace(/\?/g,".")}$`,"i");f.data.files=f.data.files.filter(fe=>fe.name.toLowerCase().includes(H)?!0:Ke.test(fe.name))}return f.data.files=f.data.files.sort((H,J)=>(0,L.UB)(H.name,J.name)),f.data.files=f.data.files.sort((H,J)=>J.type-H.type),a.length>0&&a!=="/"&&a!=="\\"&&(Q=!0,f.data.files.unshift({name:"..",size:"0",type:3,modTime:0})),V=[].concat(f.data.files),s(N),{data:f.data.files,success:!0,total:f.data.files.length-(Q?1:0)}}return s(Ee(N)),{data:[],success:!1,total:0}})}return n.createElement(U.default,_e({draggable:$,maskClosable:!1,destroyOnClose:!0,modalTitle:l.ZP.t("EXPLORER.TITLE"),footer:null,width:830,bodyStyle:{padding:0}},r),n.createElement(E.ZP,{rowKey:"name",tableStyle:{minHeight:"320px",maxHeight:"320px"},onRow:t=>({onDoubleClick:Ie.bind(null,t)}),scroll:{scrollToFirstRowOnChange:!0,y:300},search:!1,size:"small",loading:m,rowClassName:"file-row",onLoadingChange:y,rowSelection:{selectedRowKeys:G,onChange:de,alwaysShowAlert:!0},tableAlertRender:()=>l.ZP.t("EXPLORER.MULTI_SELECT_LABEL").replace("{0}",String(G.length)).replace("{1}",String(V.length)),tableAlertOptionRender:G.length===0?null:Ce,options:Te,columns:De,request:Xe,pagination:!1,actionRef:z,components:Ae}),n.createElement(Z.Z,{style:{right:"59px"},className:"header-button",icon:n.createElement(O.Z,null),onClick:()=>{z.current.reload()}}),n.createElement(Z.Z,{style:{right:"115px"},className:"header-button",icon:n.createElement(A,null),onClick:Se}),n.createElement("input",{id:"file-uploader",type:"file",onChange:Ze,style:{display:"none"}}),k&&n.createElement(k,{path:a,file:se,device:r.device,content:ye,onCancel:t=>{re(""),ie(""),C(!0),t&&z.current.reload()}}),n.createElement(ee.default,{open:w,path:a,file:w,device:r.device,onSuccess:Be,onCancel:We}),n.createElement(B.Z,{preview:{visible:M,src:M,onVisibleChange:()=>{URL.revokeObjectURL(M),D("")}}}))}function xe(r){let a=p?"\\":"/",s=[],M=[],D=r.path;D.endsWith(a)&&(D=D.substring(0,D.length-1)),D.length>0&&D!=="/"&&D!=="\\"&&(s=D.split(a));for(let m=0;m<s.length;m++){let y=s[m];m===0&&p&&y.endsWith(":")&&(y=y.substring(0,y.length-1)),M.push({name:y,path:s.slice(0,m+1).join(a)+a})}if(s.length>0&&p){let m=s[0];m.endsWith(":")&&(m=m.substring(0,m.length-1)),s[0]=m}return M.pop(),React.createElement(Breadcrumb,{style:{marginLeft:"10px",marginRight:"10px"},disabled:r.loading},React.createElement(Breadcrumb.Item,{style:{cursor:"pointer"},onClick:r.onClick.bind(null,"/")},React.createElement(HomeOutlined,null)),M.map(m=>React.createElement(Breadcrumb.Item,{key:m.path,style:{cursor:"pointer"},onClick:r.onClick.bind(null,m.path)},m.name)),s.length>0?React.createElement(Breadcrumb.Item,null,s[s.length-1]):null)}const Le=ge},20852:(x,g,e)=>{e.r(g),e.d(g,{default:()=>P});var n=e(67294),R=e(80129),E=e.n(R),c=e(81027),v=e(9669),d=e.n(v),T=e(48086),Z=e(50146),B=e(61859),L=e(82833),h=e(37240),W=e(47181);let l=null;function u(O){const[F,I]=(0,n.useState)(!!O.file),[j,X]=(0,n.useState)(0),[_,A]=(0,n.useState)(0);(0,n.useEffect)(()=>{A(0),O.file&&(I(!0),X(0))},[O.file]);function Y(){if(_!==0){b();return}const ee=E().stringify({device:O.device.id,path:O.path,file:O.file.name});let K=1;A(1),window.onbeforeunload=c.Vn,l=new AbortController,d().post("/api/device/file/upload?"+ee,O.file,{headers:{"Content-Type":"application/octet-stream"},timeout:0,onUploadProgress:S=>{let te=Math.round(S.loaded*100/S.total);X(te)},signal:l.signal}).then(S=>{S.data.code===0?(K=2,A(2),T.ZP.success(h.ZP.t("EXPLORER.UPLOAD_SUCCESS"))):(K=3,A(3))}).catch(S=>{d().isCancel(S)?(K=4,A(4),T.ZP.error(h.ZP.t("EXPLORER.UPLOAD_ABORTED"))):(K=3,A(3),T.ZP.error(h.ZP.t("EXPLORER.UPLOAD_FAILED")+h.ZP.t("COMMON.COLON")+S.message))}).finally(()=>{l=null,window.onbeforeunload=null,setTimeout(()=>{I(!1),K===2?O.onSuccess():O.onCancel()},1500)})}function b(){if(_===0){I(!1),setTimeout(O.onCancel,300);return}if(_===1){Z.Z.confirm({autoFocusButton:"cancel",content:h.ZP.t("EXPLORER.UPLOAD_CANCEL_CONFIRM"),onOk:()=>{l.abort()},okButtonProps:{danger:!0}});return}setTimeout(()=>{I(!1),setTimeout(O.onCancel,300)},1500)}function U(){switch(_){case 1:return j+"%";case 2:return h.ZP.t("EXPLORER.UPLOAD_SUCCESS");case 3:return h.ZP.t("EXPLORER.UPLOAD_FAILED");case 4:return h.ZP.t("EXPLORER.UPLOAD_ABORTED");default:return h.ZP.t("EXPLORER.UPLOAD")}}return n.createElement(W.default,{centered:!0,draggable:!0,open:F,closable:!1,keyboard:!1,maskClosable:!1,destroyOnClose:!0,confirmLoading:_===1,okText:h.ZP.t(_===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),modalTitle:h.ZP.t(_===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),okButtonProps:{disabled:_!==0},cancelButtonProps:{disabled:_>1},onCancel:b,onOk:Y,width:550},n.createElement("div",null,n.createElement("span",{style:{whiteSpace:"nowrap",fontSize:"20px",marginRight:"10px"}},U()),n.createElement(B.Z.Text,{ellipsis:{rows:1},style:{maxWidth:"calc(100% - 140px)"}},O.file.name),n.createElement("span",{style:{whiteSpace:"nowrap"}},"\uFF08"+(0,c.BU)(O.file.size)+"\uFF09")),n.createElement(L.Z,{strokeLinecap:"butt",percent:j,showInfo:!1}))}const P=u},47181:(x,g,e)=>{e.r(g),e.d(g,{default:()=>W});var n=e(50146),R=e(67294),E=e(61193),c=e.n(E),v=Object.defineProperty,d=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,B=(l,u,P)=>u in l?v(l,u,{enumerable:!0,configurable:!0,writable:!0,value:P}):l[u]=P,L=(l,u)=>{for(var P in u||(u={}))T.call(u,P)&&B(l,P,u[P]);if(d)for(var P of d(u))Z.call(u,P)&&B(l,P,u[P]);return l};function h(l){const[u,P]=(0,R.useState)(!0),[O,F]=(0,R.useState)({left:0,top:0,bottom:0,right:0}),I=(0,R.useRef)(null),j=(X,_)=>{var A;const{clientWidth:Y,clientHeight:b}=window.document.documentElement,U=(A=I.current)==null?void 0:A.getBoundingClientRect();!U||u||F({left:-U.left+_.x,right:Y-(U.right-_.x),top:-U.top+_.y,bottom:b-(U.bottom-_.y)})};return R.createElement(n.Z,L({title:R.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{u&&l.draggable&&P(!1)},onMouseOut:()=>{P(!0)},onFocus:()=>{},onBlur:()=>{P(!0)}},l.modalTitle),modalRender:X=>R.createElement(c(),{disabled:u||!l.draggable,bounds:O,onStart:(_,A)=>j(_,A)},R.createElement("div",{ref:I},X))},l),l.children)}const W=h},26213:(x,g,e)=>{e.r(g),e.d(g,{default:()=>O});var n=e(93379),R=e.n(n),E=e(7795),c=e.n(E),v=e(90569),d=e.n(v),T=e(3565),Z=e.n(T),B=e(19216),L=e.n(B),h=e(44589),W=e.n(h),l=e(78791),u={};u.styleTagTransform=W(),u.setAttributes=Z(),u.insert=d().bind(null,"head"),u.domAPI=c(),u.insertStyleElement=L();var P=R()(l.Z,u);const O=l.Z&&l.Z.locals?l.Z.locals:void 0}}]);
