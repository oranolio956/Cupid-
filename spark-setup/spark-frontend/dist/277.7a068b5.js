(self.webpackChunkspark=self.webpackChunkspark||[]).push([[277,921],{16313:w=>{var k=function(){"use strict";function o(n,s,d,u){var x;typeof s=="object"&&(d=s.depth,u=s.prototype,x=s.filter,s=s.circular);var C=[],b=[],m=typeof Buffer!="undefined";typeof s=="undefined"&&(s=!0),typeof d=="undefined"&&(d=1/0);function v(g,O){if(g===null)return null;if(O==0)return g;var e,r;if(typeof g!="object")return g;if(o.__isArray(g))e=[];else if(o.__isRegExp(g))e=new RegExp(g.source,i(g)),g.lastIndex&&(e.lastIndex=g.lastIndex);else if(o.__isDate(g))e=new Date(g.getTime());else{if(m&&Buffer.isBuffer(g))return Buffer.allocUnsafe?e=Buffer.allocUnsafe(g.length):e=new Buffer(g.length),g.copy(e),e;typeof u=="undefined"?(r=Object.getPrototypeOf(g),e=Object.create(r)):(e=Object.create(u),r=u)}if(s){var a=C.indexOf(g);if(a!=-1)return b[a];C.push(g),b.push(e)}for(var y in g){var R;r&&(R=Object.getOwnPropertyDescriptor(r,y)),!(R&&R.set==null)&&(e[y]=v(g[y],O-1))}return e}return v(n,d)}o.clonePrototype=function(s){if(s===null)return null;var d=function(){};return d.prototype=s,new d};function t(n){return Object.prototype.toString.call(n)}o.__objToStr=t;function p(n){return typeof n=="object"&&t(n)==="[object Date]"}o.__isDate=p;function c(n){return typeof n=="object"&&t(n)==="[object Array]"}o.__isArray=c;function l(n){return typeof n=="object"&&t(n)==="[object RegExp]"}o.__isRegExp=l;function i(n){var s="";return n.global&&(s+="g"),n.ignoreCase&&(s+="i"),n.multiline&&(s+="m"),s}return o.__getRegExpFlags=i,o}();w.exports&&(w.exports=k)},86010:(w,k,o)=>{"use strict";o.r(k),o.d(k,{default:()=>p});function t(c){var l,i,n="";if(typeof c=="string"||typeof c=="number")n+=c;else if(typeof c=="object")if(Array.isArray(c))for(l=0;l<c.length;l++)c[l]&&(i=t(c[l]))&&(n&&(n+=" "),n+=i);else for(l in c)c[l]&&(n&&(n+=" "),n+=l);return n}function p(){for(var c=0,l,i,n="";c<arguments.length;)(l=arguments[c++])&&(i=t(l))&&(n&&(n+=" "),n+=i);return n}},34606:(w,k)=>{var o;(function(t){t(typeof DO_NOT_EXPORT_CRC=="undefined"?k:o={})})(function(t){t.version="1.2.2";function p(){for(var f=0,P=new Array(256),_=0;_!=256;++_)f=_,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,f=f&1?-306674912^f>>>1:f>>>1,P[_]=f;return typeof Int32Array!="undefined"?new Int32Array(P):P}var c=p();function l(f){var P=0,_=0,T=0,F=typeof Int32Array!="undefined"?new Int32Array(4096):new Array(4096);for(T=0;T!=256;++T)F[T]=f[T];for(T=0;T!=256;++T)for(_=f[T],P=256+T;P<4096;P+=256)_=F[P]=_>>>8^f[_&255];var S=[];for(T=1;T!=16;++T)S[T-1]=typeof Int32Array!="undefined"?F.subarray(T*256,T*256+256):F.slice(T*256,T*256+256);return S}var i=l(c),n=i[0],s=i[1],d=i[2],u=i[3],x=i[4],C=i[5],b=i[6],m=i[7],v=i[8],g=i[9],O=i[10],e=i[11],r=i[12],a=i[13],y=i[14];function R(f,P){for(var _=P^-1,T=0,F=f.length;T<F;)_=_>>>8^c[(_^f.charCodeAt(T++))&255];return~_}function M(f,P){for(var _=P^-1,T=f.length-15,F=0;F<T;)_=y[f[F++]^_&255]^a[f[F++]^_>>8&255]^r[f[F++]^_>>16&255]^e[f[F++]^_>>>24]^O[f[F++]]^g[f[F++]]^v[f[F++]]^m[f[F++]]^b[f[F++]]^C[f[F++]]^x[f[F++]]^u[f[F++]]^d[f[F++]]^s[f[F++]]^n[f[F++]]^c[f[F++]];for(T+=15;F<T;)_=_>>>8^c[(_^f[F++])&255];return~_}function D(f,P){for(var _=P^-1,T=0,F=f.length,S=0,Q=0;T<F;)S=f.charCodeAt(T++),S<128?_=_>>>8^c[(_^S)&255]:S<2048?(_=_>>>8^c[(_^(192|S>>6&31))&255],_=_>>>8^c[(_^(128|S&63))&255]):S>=55296&&S<57344?(S=(S&1023)+64,Q=f.charCodeAt(T++)&1023,_=_>>>8^c[(_^(240|S>>8&7))&255],_=_>>>8^c[(_^(128|S>>2&63))&255],_=_>>>8^c[(_^(128|Q>>6&15|(S&3)<<4))&255],_=_>>>8^c[(_^(128|Q&63))&255]):(_=_>>>8^c[(_^(224|S>>12&15))&255],_=_>>>8^c[(_^(128|S>>6&63))&255],_=_>>>8^c[(_^(128|S&63))&255]);return~_}t.table=c,t.bstr=R,t.buf=M,t.str=D})},34575:(w,k,o)=>{var t=o(16313);w.exports=function(p,c){return p=p||{},Object.keys(c).forEach(function(l){typeof p[l]=="undefined"&&(p[l]=t(c[l]))}),p}},47181:(w,k,o)=>{"use strict";o.r(k),o.d(k,{default:()=>b});var t=o(50146),p=o(67294),c=o(61193),l=o.n(c),i=Object.defineProperty,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,u=(m,v,g)=>v in m?i(m,v,{enumerable:!0,configurable:!0,writable:!0,value:g}):m[v]=g,x=(m,v)=>{for(var g in v||(v={}))s.call(v,g)&&u(m,g,v[g]);if(n)for(var g of n(v))d.call(v,g)&&u(m,g,v[g]);return m};function C(m){const[v,g]=(0,p.useState)(!0),[O,e]=(0,p.useState)({left:0,top:0,bottom:0,right:0}),r=(0,p.useRef)(null),a=(y,R)=>{var M;const{clientWidth:D,clientHeight:f}=window.document.documentElement,P=(M=r.current)==null?void 0:M.getBoundingClientRect();!P||v||e({left:-P.left+R.x,right:D-(P.right-R.x),top:-P.top+R.y,bottom:f-(P.bottom-R.y)})};return p.createElement(t.Z,x({title:p.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{v&&m.draggable&&g(!1)},onMouseOut:()=>{g(!0)},onFocus:()=>{},onBlur:()=>{g(!0)}},m.modalTitle),modalRender:y=>p.createElement(l(),{disabled:v||!m.draggable,bounds:O,onStart:(R,M)=>a(R,M)},p.createElement("div",{ref:r},y))},m),m.children)}const b=C},79793:(w,k,o)=>{"use strict";o.r(k),o.d(k,{default:()=>ce});var t=o(67294),p=o(48086),c=o(28682),l=o(19650),i=o(71577),n=o(13013),s=o(12320),d=o.n(s),u=o(67511),x=o.n(u),C=o(12617),b=o.n(C),m=o(23279),v=o.n(m),g=o(71011),O=o.n(g),e=o(29492),r=o(37240),a=o(81027),y=o(47181);const R=o(89642);let M=null,D=null,f=null,P=null,_=null,T=null,F=null,S=null,Q=!1,W=!1,_e=0,j={content:"",output:""};function oe(q){let G=q.device.os,X=(0,t.createRef)(),ie=(0,t.useCallback)(E=>{E!==null&&(ie.current=E,q.open&&(F=(0,a.vS)((0,a.ym)(32)),P=new C.FitAddon,f=new u.WebLinksAddon,_=new s.Terminal({convertEol:!0,allowProposedApi:!0,allowTransparency:!1,cursorBlink:!0,cursorStyle:"block",fontFamily:"Hack, monospace",fontSize:16,logLevel:"off"}),T=ne(null),_.loadAddon(P),_.open(ie.current),P.fit(),_.clear(),_.loadAddon(f),window.onresize=he,_e=setInterval(()=>{W&&re({act:"PING"})},1e4),_.focus(),fe()))},[q.open]);function le(){clearInterval(_e),D&&(D._last_header_name="ZRINIT",D.close(),D=null),W&&(re({act:"TERMINAL_KILL"}),S.onclose=null,S.close()),T==null||T.dispose(),T=null,P==null||P.dispose(),P=null,f==null||f.dispose(),f=null,M=null,_==null||_.dispose(),_=null,S=null,W=!1,Q=!1}function ne(E){E==null||E.dispose(),j={content:"",output:""};let A=null;return G==="windows"?A=_.onData(I(j)):(U(),A=_.onData(B(j))),S=new WebSocket((0,a.BS)(!0,`api/device/terminal?device=${q.device.id}&secret=${(0,a.nc)(F)}`)),S.binaryType="arraybuffer",S.onopen=()=>{W=!0},S.onmessage=L=>{Z(L.data,j)},S.onclose=L=>{W&&(W=!1,_.write(`
${r.ZP.t("COMMON.DISCONNECTED")}
`),F=(0,a.vS)((0,a.ym)(32)),D!==null&&(D._last_header_name="ZRINIT",D.close(),D=null))},S.onerror=L=>{console.error(L),W?(W=!1,_.write(`
${r.ZP.t("COMMON.DISCONNECTED")}
`),F=(0,a.vS)((0,a.ym)(32)),D!==null&&(D._last_header_name="ZRINIT",D.close(),D=null)):_.write(`
${r.ZP.t("COMMON.CONNECTION_FAILED")}
`)},A}function Z(E){var A;if(E=new Uint8Array(E),E[0]===34&&E[1]===22&&E[2]===19&&E[3]===17&&E[4]===21&&E[5]===0)if(E=E.slice(8),M===null)h((0,a.y0)(E));else try{M.consume(E)}catch(L){console.error(L)}else{E=(0,a.pe)(E,F);try{E=JSON.parse(E)}catch(L){}if(W){if((E==null?void 0:E.act)==="TERMINAL_OUTPUT"){if(E=(0,a.vS)((A=E==null?void 0:E.data)==null?void 0:A.output),M===null)h((0,a.y0)(E));else try{M.consume(E)}catch(L){console.error(L)}return}if((E==null?void 0:E.act)==="WARN"){p.ZP.warn(E.msg?(0,a.Iu)(E.msg):r.ZP.t("COMMON.UNKNOWN_ERROR"));return}if((E==null?void 0:E.act)==="QUIT"){p.ZP.warn(E.msg?(0,a.Iu)(E.msg):r.ZP.t("COMMON.UNKNOWN_ERROR")),S.close();return}}}}function h(E){if(j.output.length>0&&(E=j.output+E,j.output=""),j.content.length>0)if(E.length>=j.content.length)E.startsWith(j.content)&&(E=E.substring(j.content.length),j.content="");else{j.output=E;return}_.write(E)}function I(E){let A="",L=0,N=0,K=[],z="",ee=0;return function(H){if(!W){(H==="\r"||H===`
`||H===" ")&&(_.write(`
${r.ZP.t("COMMON.RECONNECTING")}
`),T=ne(T));return}switch(H){case"\x1B[A":L>0&&L<=K.length&&(L===K.length&&(z=A,ee=N),L--,V(),A=K[L],N=A.length,_.write(A));break;case"\x1B[B":L+1<K.length?(L++,V(),A=K[L],N=A.length,_.write(A)):L+1<=K.length&&(V(),L++,A=z,N=ee,_.write(A),_.write("\x1B[D".repeat(O()(A.substring(N)))),z="",ee=0);break;case"\x1B[C":N<A.length&&(_.write("\x1B[C".repeat(O()(A[N]))),N++);break;case"\x1B[D":N>0&&(_.write("\x1B[D".repeat(O()(A[N-1]))),N--);break;case"\r":case`
`:A==="clear"||A==="cls"?(V(),_.clear()):(_.write(`
`),$(A+`
`),E.content=A+`
`),A.length>0&&K.push(A),N=0,A="",K.length>128&&(K=K.slice(K.length-128)),z="",ee=0,L=K.length;break;case"\x7F":if(A.length>0&&N>0){N--;let Y=O()(A[N]),te=A.substring(0,N),se=A.substring(N+1);A=te+se,_.write("\b".repeat(Y)),_.write(se+" ".repeat(Y)),_.write("\x1B[D".repeat(O()(se)+Y))}break;default:if(H>=String.fromCharCode(32)&&H<=String.fromCharCode(123)||H>="\xA0"){if(N<A.length){let Y=A.substring(0,N),te=A.substring(N);A=Y+H+te,_.write(H+te),_.write("\x1B[D".repeat(O()(te)))}else A+=H,_.write(H);N+=H.length}}};function V(){let H=A.substring(0,N),Y=A.substring(N);_.write("\b".repeat(O()(H))),_.write(" ".repeat(O()(A))),_.write("\b".repeat(O()(A)))}}function B(E){return function(A){if(!W){(A==="\r"||A===" ")&&(_.write(`
${r.ZP.t("COMMON.RECONNECTING")}
`),T=ne(T));return}ae(A)}}function U(){const E=()=>{X.current.setFileSelect(!1),D._last_header_name="ZRINIT",D.close(),D=null};M=new R.Sentry({on_retract:()=>{},on_detect:N=>{D!==null&&E(),D=N.confirm(),D.type==="send"?A(D):L(D)},to_terminal:N=>{h((0,a.y0)(new Uint8Array(N)))},sender:N=>{re(new Uint8Array(N),!0)}});function A(){return new Promise((N,K)=>{let z=document.getElementById("file-uploader"),ee=!1;z.onchange=V=>{if(X.current.setFileSelect(!1),D===null){V.target.value=null,p.ZP.warn(r.ZP.t("TERMINAL.ZMODEM_UPLOADER_CALL_TIMEOUT"));return}let H=V.target.files[0];if(H===void 0){_.write(`
`+r.ZP.t("TERMINAL.ZMODEM_UPLOADER_NO_FILE")+`
`),E(),K("NO_FILE_SELECTED");return}ee=!0,V.target.value=null,_.write(`
`+H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_START")+`
`),R.Browser.send_files(D,[H],{on_offer_response:(Y,te)=>{te||(_.write(Y.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_REJECTED")+`
`),K("TRANSFER_REJECTED"))},on_file_complete:()=>{_.write(H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_SUCCESS")+`
`),N()}}).catch(Y=>{console.error(Y),_.write(H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_FAILED")+`
`),K(Y)}).finally(()=>{E()})},_.write(`
`+r.ZP.t("TERMINAL.ZMODEM_UPLOADER_TIP")),_.write(`
`+r.ZP.t("TERMINAL.ZMODEM_UPLOADER_WARNING")+`
`),X.current.setFileSelect(()=>{z.click()}),z.click(),setTimeout(()=>{ee||(_.write(`
`+r.ZP.t("TERMINAL.ZMODEM_UPLOADER_CALL_TIMEOUT")+`
`),E(),K("UPLOADER_CALL_TIMEOUT"))},1e4)})}function L(){return new Promise((N,K)=>{let z=!1,ee=!1;D.on("offer",V=>{let H=V.get_details();if(H.size>16*1024*1024)V.skip(),_.write(`
`+H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_FILE_TOO_LARGE")+`
`);else{let Y=H.name,te=[];V.on("input",se=>{te.push(new Uint8Array(se))}),V.accept().then(()=>{R.Browser.save_to_disk(te,Y),_.write(`
`+H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_SUCCESS")+`
`),z=!0,N()}).catch(se=>{console.error(se),_.write(`
`+H.name+"	"+r.ZP.t("TERMINAL.ZMODEM_TRANSFER_FAILED")+`
`),ee=!0,K()})}}),D.on("session_end",()=>{D=null,!z&&!ee&&K()}),D.start()})}}function $(E){W&&re({act:"TERMINAL_INPUT",data:{input:(0,a.K7)(E)}})}function ae(E){if(W){if(Q&&E.length===1){let A=E.charCodeAt(0);A>=97&&A<=122?(A-=96,Q=!1,X.current.setCtrl(!1)):A>=64&&A<=95&&(A-=64,Q=!1,X.current.setCtrl(!1)),E=String.fromCharCode(A)}re({act:"TERMINAL_INPUT",data:{input:(0,a.K7)(E)}})}}function re(E,A){if(W){let L=[];if(A)if(E.length>65536){let K=0;for(;K<E.length;){let z=E.slice(K,K+65536);re(z,!0),K+=z.length}}else L=E;else L=(0,a.HI)((0,a.by)(JSON.stringify(E)),F);let N=new Uint8Array(L.length+8);N.set(new Uint8Array([34,22,19,17,21,A?0:1]),0),N.set(new Uint8Array([L.length>>8,L.length&255]),6),N.set(L,8),S.send(N)}}function fe(){var E,A,L;let N=document.body.clientHeight,K=Math.floor(N/42),z=_==null?void 0:_.cols;(E=P==null?void 0:P.fit)==null||E.call(P),(A=_==null?void 0:_.resize)==null||A.call(_,z,K),(L=_==null?void 0:_.scrollToBottom)==null||L.call(_),W&&re({act:"TERMINAL_RESIZE",data:{cols:z,rows:K}})}function he(){typeof fe=="function"&&v()(fe,70)}function Ee(E){var A;if((A=_==null?void 0:_.focus)==null||A.call(_),!W&&E){X.current.setCtrl(!1);return}Q=E}function pe(E,A){var L;ae(E),A&&((L=_==null?void 0:_.focus)==null||L.call(_))}return t.createElement(y.default,{draggable:!0,maskClosable:!1,modalTitle:r.ZP.t("TERMINAL.TITLE"),open:q.open,onCancel:q.onCancel,bodyStyle:{padding:12},afterClose:le,destroyOnClose:!0,footer:null,height:250,width:900},t.createElement(J,{ref:X,onCtrl:Ee,onExtKey:pe,open:G!=="windows"}),t.createElement("div",{style:{padding:"0 0 0 5px",backgroundColor:"#000"},ref:ie}),t.createElement("input",{id:"file-uploader",type:"file",style:{display:"none"}}))}class J extends t.Component{constructor(G){super(G),this.open=G.open,this.open&&(this.funcKeys=[{key:"\x1BOP",label:"F1"},{key:"\x1BOQ",label:"F2"},{key:"\x1BOR",label:"F3"},{key:"\x1BOS",label:"F4"},{key:"\x1B[15~",label:"F5"},{key:"\x1B[17~",label:"F6"},{key:"\x1B[18~",label:"F7"},{key:"\x1B[19~",label:"F8"},{key:"\x1B[20~",label:"F9"},{key:"\x1B[21~",label:"F10"},{key:"\x1B[23~",label:"F11"},{key:"\x1B[24~",label:"F12"}],this.specialKeys=[{key:"\x1B[1~",label:"HOME"},{key:"\x1B[2~",label:"INS"},{key:"\x1B[3~",label:"DEL"},{key:"\x1B[4~",label:"END"},{key:"\x1B[5~",label:"PGUP"},{key:"\x1B[6~",label:"PGDN"}],this.funcMenu=t.createElement(c.Z,{onClick:this.onKey.bind(this)},this.funcKeys.map(X=>t.createElement(c.Z.Item,{key:X.key},X.label))),this.specialMenu=t.createElement(c.Z,{onClick:this.onKey.bind(this)},this.specialKeys.map(X=>t.createElement(c.Z.Item,{key:X.key},X.label))),this.state={ctrl:!1,fileSelect:!1})}onCtrl(){this.setState({ctrl:!this.state.ctrl}),this.props.onCtrl(!this.state.ctrl)}onKey(G){this.props.onExtKey(G.key,!1)}onExtKey(G){this.props.onExtKey(G,!0)}onFileSelect(){typeof this.state.fileSelect=="function"&&this.state.fileSelect()}setCtrl(G){this.setState({ctrl:G})}setFileSelect(G){this.setState({fileSelect:G})}render(){return this.open?t.createElement(l.Z,{style:{paddingBottom:12}},t.createElement(t.Fragment,null,t.createElement(i.Z,{type:this.state.ctrl?"primary":"default",onClick:this.onCtrl.bind(this)},"CTRL"),t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"\x1B")},"ESC"),t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"	")},"TAB")),t.createElement(t.Fragment,null,t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"\x1B[A")},"\u2B06"),t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"\x1B[B")},"\u2B07"),t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"\x1B[C")},"\u27A1"),t.createElement(i.Z,{onClick:this.onExtKey.bind(this,"\x1B[D")},"\u2B05")),t.createElement(n.Z.Button,{overlay:this.specialMenu},r.ZP.t("TERMINAL.SPECIAL_KEYS")),t.createElement(n.Z.Button,{overlay:this.funcMenu},r.ZP.t("TERMINAL.FUNCTION_KEYS")),this.state.fileSelect?t.createElement(i.Z,{onClick:this.onFileSelect.bind(this)},"\u9009\u62E9\u6587\u4EF6"):null):null}}const ce=oe},94226:w=>{"use strict";var k=w.exports;const o=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102],t={};for(var p=0;p<o.length;p++)t[o[p]]=p;k.ENCODELIB={pack_u16_be:function(l){if(l>65535)throw"Number cannot exceed 16 bits: "+l;return[l>>8,l&255]},pack_u32_le:function(l){var i=l/65536;return[l&255,(l&65535)>>8,i&255,i>>8]},unpack_u16_be:function(l){return(l[0]<<8)+l[1]},unpack_u32_le:function(l){return l[0]+(l[1]<<8)+(l[2]<<16)+l[3]*16777216},octets_to_hex:function(l){for(var i=[],n=0;n<l.length;n++)i.push(o[l[n]>>4],o[l[n]&15]);return i},parse_hex_octets:function(l){for(var i=new Array(l.length/2),n=0;n<i.length;n++)i[n]=(t[l[2*n]]<<4)+t[l[1+2*n]];return i}}},22534:w=>{class k{encode(c){c=unescape(encodeURIComponent(c));for(var l=new Array(c.length),i=0;i<c.length;i++)l[i]=c.charCodeAt(i);return new Uint8Array(l)}}class o{decode(c){return decodeURIComponent(escape(String.fromCharCode.apply(String,c)))}}var t=w.exports;t.Text={Encoder:typeof TextEncoder!="undefined"?TextEncoder:k,Decoder:typeof TextDecoder!="undefined"?TextDecoder:o}},46705:(w,k,o)=>{"use strict";const t=o(34606);var p=w.exports;Object.assign(p,o(50903),o(94226));var c;const l=16,i=4129,n=65535,s=1<<l-1;function d(){c=new Array(256);for(var C=l-8,b=0;b<256;b++){for(var m=b<<C&n,v=0;v<8;v++)(m&s)!==0?(m<<=1,m^=i):m<<=1;c[b]=m&n}}function u(C,b){return c||d(),c[b>>8&255]^(255&b)<<8^C}function x(C,b){var m;if(C.join()!==b.join())throw new p.Error("crc",b,C)}p.CRC={crc16:function(b){for(var m=b[0],v=1;v<b.length;v++)m=u(b[v],m);return m=u(0,u(0,m)),p.ENCODELIB.pack_u16_be(m)},crc32:function(b){return p.ENCODELIB.pack_u32_le(t.buf(b)>>>0)},verify16:function(b,m){return x(this.crc16(b),m)},verify32:function(b,m){try{x(this.crc32(b),m)}catch(v){throw v.input=b.slice(0),v}}}},48179:(w,k,o)=>{"use strict";var t=w.exports;Object.assign(t,o(97510));var p,c;const l=t.ZMLIB.ZDLE;t.ZDLE=class de{constructor(n){this._config={},n&&this.set_escape_ctrl_chars(!!n.escape_ctrl_chars)}set_escape_ctrl_chars(n){if(typeof n!="boolean")throw"need boolean!";n!==this._config.escape_ctrl_chars&&(this._config.escape_ctrl_chars=n,this._setup_zdle_table())}escapes_ctrl_chars(){return!!this._config.escape_ctrl_chars}encode(n){if(!this._zdle_table)throw"No ZDLE encode table configured!";var s=this._zdle_table,d=this._lastcode,u=new ArrayBuffer(2*n.length),x=new Uint8Array(u),C=this._config.escape_ctrl_chars,b=0;for(p=0;p<n.length;p++){if(c=s[n[p]],!c)throw console.trace(),console.error("bad encode() call:",JSON.stringify(n)),this._lastcode=d,"Invalid octet: "+n[p];d=n[p],c===1||(C||c===2||(d&127)===64)&&(x[b]=l,b++,d^=64),x[b]=d,b++}return this._lastcode=d,n.splice(0),n.push.apply(n,new Uint8Array(u,0,b)),n}static decode(n){for(var s=n.length-1;s>=0;s--)n[s]===l&&n.splice(s,2,n[s+1]-64);return n}static splice(n,s,d){var u=0;s||(s=0);for(var x=s;x<n.length&&u<d;x++)u++,n[x]===l&&x++;if(u===d)return n.length===x-1?void 0:(n.splice(0,s),de.decode(n.splice(0,x-s)))}_setup_zdle_table(){for(var n=new Array(256),s=0;s<n.length;s++)if(s&96)n[s]=1;else switch(s){case l:case t.ZMLIB.XOFF:case t.ZMLIB.XON:case t.ZMLIB.XOFF|128:case t.ZMLIB.XON|128:n[s]=2;break;case 16:case 144:n[s]=this._config.turbo_escape?1:2;break;case 13:case 141:n[s]=this._config.escape_ctrl_chars?2:this._config.turbo_escape?1:3;break;default:n[s]=this._config.escape_ctrl_chars?2:1}this._zdle_table=n}}},50903:w=>{"use strict";var k=w.exports;function o(l,i){return this.got=l.slice(0),this.expected=i.slice(0),"CRC check failed! (got: "+l.join()+"; expected: "+i.join()+")"}function t(l){return l}const p={aborted:"Session aborted",peer_aborted:"Peer aborted session",already_aborted:"Session already aborted",crc:o,validation:t};function c(l){const i=p[l];switch(typeof i){case"string":return i;case"function":var n=[].slice.call(arguments).slice(1);return i.apply(this,n)}return null}k.Error=class extends Error{constructor(i){super();var n=c.apply(this,arguments);n?(this.type=i,this.message=n):this.message=i}}},63761:(w,k,o)=>{"use strict";var t=w.exports;Object.assign(t,o(94226),o(48179),o(97510),o(46705),o(50903));const p="*".charCodeAt(0),c="A".charCodeAt(0),l="B".charCodeAt(0),i="C".charCodeAt(0),n=[13,10],s=n.slice(0).concat([t.ZMLIB.XON]),d=[p,p,t.ZMLIB.ZDLE,l],u=[p,t.ZMLIB.ZDLE,c],x=[p,t.ZMLIB.ZDLE,i];t.Header=class{static trim_leading_garbage(h){var I=[],B,U,$=0;e:for(;h.length&&!U;){var ae=h.indexOf(p);if(ae===-1){B=!0;break e}else{if(I.push.apply(I,h.splice(0,ae)),h.length<2)break e;if(h[1]===p)if(h.length<d.length){if(h.join()===d.slice(0,h.length).join())break e}else h[2]===d[2]&&h[3]===d[3]&&(U=ne);else if(h[1]===t.ZMLIB.ZDLE){if(h.length<u.length)break e;h[2]===u[2]?U=X:h[2]===x[2]&&(U=le)}U||I.push(h.shift())}}return B&&I.push.apply(I,h.splice(0)),I}static parse(h){var I;if(h[1]===p)return I=ne(h),I&&[I,16];if(h[2]===c)return I=X(h,3),I&&[I,16];if(h[2]===i)return I=le(h),I&&[I,32];if(!(h.length<3))throw"Unrecognized/unsupported octets: "+h.join()}static build(h){var I=arguments.length===1?[arguments[0]]:Array.apply(null,arguments),B=oe[h];if(!B)throw"No frame class \u201C"+h+"\u201D is defined!";I.shift();var U=new(B.bind.apply(B,[null].concat(I)));return U}to_hex(){var h=this._crc_bytes();return d.concat(t.ENCODELIB.octets_to_hex(h.concat(t.CRC.crc16(h))),this._hex_header_ending)}to_binary16(h){return this._to_binary(h,u,t.CRC.crc16)}to_binary32(h){return this._to_binary(h,x,t.CRC.crc32)}constructor(){this._bytes4||(this._bytes4=[0,0,0,0])}_to_binary(h,I,B){var U=this._crc_bytes(),$=I.concat(h.encode(U.concat(B(U))));return $}_crc_bytes(){return[this.TYPENUM].concat(this._bytes4)}},t.Header.prototype._hex_header_ending=s;class C extends t.Header{}const b={CANFDX:1,CANOVIO:2,CANBRK:4,CANCRY:8,CANLZW:16,CANFC32:32,ESCCTL:64,ESC8:128};function m(Z){if(!b[Z])throw new t.Error("Invalid ZRINIT flag: "+Z);return b[Z]}class v extends t.Header{constructor(h,I){super();var B=0;I||(I=0),h.forEach(function(U){B|=m(U)}),this._bytes4=[I&255,I>>8,0,B]}get_buffer_size(){return t.ENCODELIB.unpack_u16_be(this._bytes4.slice(0,2))||void 0}can_full_duplex(){return!!(this._bytes4[3]&b.CANFDX)}can_overlap_io(){return!!(this._bytes4[3]&b.CANOVIO)}can_break(){return!!(this._bytes4[3]&b.CANBRK)}can_fcs_32(){return!!(this._bytes4[3]&b.CANFC32)}escape_ctrl_chars(){return!!(this._bytes4[3]&b.ESCCTL)}escape_8th_bit(){return!!(this._bytes4[3]&b.ESC8)}}const g={ESCCTL:64,ESC8:128};function O(Z){if(!g[Z])throw"Invalid ZSINIT flag: "+Z;return g[Z]}class e extends t.Header{constructor(h,I){super();var B=0;if(h.forEach(function(U){B|=O(U)}),this._bytes4=[0,0,0,B],I){if(I.length>31)throw"Attn sequence must be <= 31 bytes";if(I.some(function(U){return U>255}))throw"Attn sequence ("+I+") must be <256";this._data=I.concat([0])}}escape_ctrl_chars(){return!!(this._bytes4[3]&g.ESCCTL)}escape_8th_bit(){return!!(this._bytes4[3]&g.ESC8)}}class r extends t.Header{constructor(h){super(),h&&(this._bytes4=h.slice())}}r.prototype._hex_header_ending=n;const a={extended:{sparse:64},transport:[void 0,"compress","encrypt","rle"],management:[void 0,"newer_or_longer","crc","append","clobber","newer","mtime_or_length","protect","rename"],conversion:[void 0,"binary","text","resume"]},y=["extended","transport","management","conversion"],R=128,M=31,D=64;class f extends t.Header{get_options(){var h={sparse:!!(this._bytes4[0]&D)},I=this._bytes4.slice(0);return y.forEach(function(B,U){if(a[B]instanceof Array)B==="management"&&(h.skip_if_absent=!!(I[U]&R),I[U]&=M),h[B]=a[B][I[U]];else for(var $ in a[B])h[$]=!!(I[U]&a[B][$]),h[$]&&(I[U]^=a[B][$]);!h[B]&&I[U]&&(h[B]="unknown:"+I[U])}),h}}class P extends t.Header{}class _ extends t.Header{}class T extends t.Header{}class F extends t.Header{}T.prototype._hex_header_ending=n;class S extends t.Header{constructor(h){super(),this._bytes4=t.ENCODELIB.pack_u32_le(h)}get_offset(){return t.ENCODELIB.unpack_u32_le(this._bytes4)}}class Q extends S{}class W extends S{}class _e extends S{}const j=[[C,"ZRQINIT"],[v,"ZRINIT"],[e,"ZSINIT"],[r,"ZACK"],[f,"ZFILE"],[P,"ZSKIP"],void 0,[_,"ZABORT"],[T,"ZFIN"],[Q,"ZRPOS"],[W,"ZDATA"],[_e,"ZEOF"],[F,"ZFERR"],void 0,void 0,void 0,void 0,void 0,void 0,void 0];for(var oe={},J=0;J<j.length;J++)!j[J]||(oe[j[J][1]]=j[J][0],Object.assign(j[J][0].prototype,{TYPENUM:J,NAME:j[J][1]}));const ce=[C,v,e,r,f,P,"ZNAK",_,T,Q,W,_e,F,"ZCRC","ZCHALLENGE","ZCOMPL","ZCAN","ZFREECNT","ZCOMMAND","ZSTDERR"];function q(Z){var h=ce[Z];if(typeof h=="string")throw"Received unsupported header: "+h;return G(h)}function G(Z){return Z.prototype instanceof S?new Z(0):new Z([])}function X(Z){var h=t.ZDLE.splice(Z,u.length,7);return h&&ie(h)}function ie(Z){t.CRC.verify16(Z.slice(0,5),Z.slice(5));var h=Z[0],I=q(h);return I._bytes4=Z.slice(1,5),I}function le(Z){var h=t.ZDLE.splice(Z,x.length,9);if(!!h){t.CRC.verify32(h.slice(0,5),h.slice(5));var I=h[0],B=q(I);return B._bytes4=h.slice(1,5),B}}function ne(Z){var h=Z.indexOf(138);h===-1&&(h=Z.indexOf(10));var I,B;if(h===-1){Z.length>11&&(I="Invalid hex header - no LF detected within 12 bytes!");return}else if(B=Z.splice(0,h),Z.shift(),B.length===19){var U=B.pop();U!==13&&U!==141&&(I="Invalid hex header: (CR/)LF doesn\u2019t have CR!")}else B.length!==18&&(I="Invalid hex header: invalid number of bytes before LF!");if(I)throw I+=" ("+B.length+" bytes: "+B.join()+")",I;B.splice(0,4);var $=t.ENCODELIB.parse_hex_octets(B);return ie($)}t.Header.parse_hex=ne},97510:w=>{"use strict";var k=w.exports;const o=24,t=17,p=19,c=128|t,l=128|p,i=24;k.ZMLIB={ZDLE:o,XON:t,XOFF:p,ABORT_SEQUENCE:[i,i,i,i,i],strip_ignored_bytes:function(s){for(var d=s.length-1;d>=0;d--)switch(s[d]){case t:case c:case p:case l:s.splice(d,1);continue}return s},find_subarray:function(s,d){var u=0,x,C=Date.now();e:for(;u!==-1;){if(u=s.indexOf(d[0],u),u===-1)break e;for(x=1;x<d.length;x++)if(s[u+x]!==d[x]){u++;continue e}return u}return-1}}},89642:(w,k,o)=>{Object.assign(w.exports,o(73618),o(89257))},89257:(w,k,o)=>{"use strict";var t=w.exports;window.Zmodem=t,Object.assign(t,o(89642));function p(c){if(c.aborted())throw new t.Error("aborted")}t.Browser={send_files:function(l,i,n){n||(n={});for(var s=[],d=0,u=i.length-1;u>=0;u--){var x=i[u];d+=x.size,s[u]={obj:x,name:x.name,size:x.size,mtime:new Date(x.lastModified),files_remaining:i.length-u,bytes_remaining:d}}var C=0;function b(){var m=s[C];return m?(C++,l.send_offer(m).then(function(g){return n.on_offer_response&&n.on_offer_response(m.obj,g),g===void 0?b():new Promise(function(O){var e=new FileReader;e.onerror=function(y){throw console.error("file read error",y),"File read error: "+y};var r;e.onprogress=function(y){y.target.result&&(r=new Uint8Array(y.target.result,g.get_offset()),p(l),g.send(r),n.on_progress&&n.on_progress(m.obj,g,r))},e.onload=function(y){r=new Uint8Array(y.target.result,g,r),p(l),g.end(r).then(function(){n.on_progress&&r.length&&n.on_progress(m.obj,g,r),n.on_file_complete&&n.on_file_complete(m.obj,g),O(b())})},e.readAsArrayBuffer(m.obj)})})):Promise.resolve()}return b()},save_to_disk:function(l,i){var n=new Blob(l),s=URL.createObjectURL(n),d=document.createElement("a");d.style.display="none",d.href=s,d.download=i,d.click(),setTimeout(()=>URL.revokeObjectURL(s),1e4)}}},73618:(w,k,o)=>{"use strict";var t=w.exports;Object.assign(t,o(97510),o(5414));const p=20,c=21,l=[42,42,24,66,48],i=["to_terminal","on_detect","on_retract","sender"],n=42;class s{constructor(u,x,C,b){this._confirmer=x,this._denier=C,this._is_valid=b,this._session_type=u}confirm(){return this._confirmer.apply(this,arguments)}deny(){return this._denier.apply(this,arguments)}is_valid(){return this._is_valid.apply(this,arguments)}get_session_role(){return this._session_type}}t.Sentry=class{constructor(u){if(!u)throw"Need options!";var x=this;i.forEach(function(C){if(!u[C])throw"Need \u201C"+C+"\u201D!";x["_"+C]=u[C]}),this._cache=[]}_after_session_end(){this._zsession=null}consume(u){if(u instanceof Array||(u=Array.prototype.slice.call(new Uint8Array(u))),this._zsession){var x=this._zsession;if(x.consume(u),x.has_ended())x.type==="receive"?u=x.get_trailing_bytes():u=[];else return}var C=this._parse(u),b=u;if(C){let g=function(){return m._parsed_session===C},O=function(){if(!this.is_valid())throw"Stale ZMODEM session!";return C.on("garbage",m._to_terminal),C.on("session_end",m._after_session_end.bind(m)),C.set_sender(m._sender),delete m._parsed_session,m._zsession=C},e=function(){this.is_valid()};!!this._parsed_session&&(this._parsed_session.type===C.type&&(b=[]),this._on_retract()),this._parsed_session=C;var m=this;this._on_detect(new s(C.type,O,this._send_abort.bind(this),g))}else{var v=this._parsed_session;this._parsed_session=null,v&&(b.length===1&&b[0]===67&&this._send_abort(),this._on_retract())}this._to_terminal(b)}get_confirmed_session(){return this._zsession||null}_send_abort(){this._sender(t.ZMLIB.ABORT_SEQUENCE)}_parse(u){var x=this._cache;for(x.push.apply(x,u);;){let C=t.ZMLIB.find_subarray(x,l);if(C===-1)break;let b=x.splice(0,C),m;try{m=t.Session.parse(x)}catch(v){}if(!m)break;return x.length===1&&x[0]===t.ZMLIB.XON&&x.shift(),x.length?null:m}return x.splice(c),null}}},5414:(w,k,o)=>{"use strict";var t=w.exports;t.DEBUG=!1,Object.assign(t,o(94226),o(22534),o(48179),o(97510),o(63761),o(82746),o(33206),o(50903));const p=5e3,c=["CANFDX","CANOVIO","CANFC32"],l=!0,i="spool_uint8array",n=8192,s=8,d=[79,79],u=t.ZMLIB.ABORT_SEQUENCE;class x{constructor(){this._on_evt={},this._evt_once_index={}}_Add_event(e){this._on_evt[e]=[],this._evt_once_index[e]=[]}_get_evt_queue(e){if(!this._on_evt[e])throw"Bad event: "+e;return this._on_evt[e]}on(e,r){var a=this._get_evt_queue(e);return a.push(r),this}off(e,r){var a=this._get_evt_queue(e);if(r){var y=a.indexOf(r);if(y===-1)throw"\u201C"+r+"\u201D is not in the \u201C"+e+"\u201D queue.";a.splice(y,1)}else a.pop();return this}_Happen(e){var r=this._get_evt_queue(e),a=Array.apply(null,arguments);a.shift();var y=this;return r.forEach(function(R){R.apply(y,a)}),r.length}}t.Session=class extends x{static parse(e){var r;try{r=t.Header.parse_hex(e)}catch(a){return}if(!!r)switch(r.NAME){case"ZRQINIT":return new t.Session.Receive;case"ZRINIT":return new t.Session.Send(r)}}set_sender(e){return this._sender=e,this}has_ended(){return this._has_ended()}consume(e){if(this._before_consume(e),this._aborted)throw new t.Error("already_aborted");!e.length||(this._strip_and_enqueue_input(e),this._check_for_abort_sequence(e)||this._consume_first())}aborted(){return!!this._aborted}constructor(){super(),this._config={},this._input_buffer=[],this._Add_event("receive"),this._Add_event("garbage"),this._Add_event("session_end")}get_role(){return this.type}_trim_leading_garbage_until_header(){var e=t.Header.trim_leading_garbage(this._input_buffer);e.length&&this._Happen("garbage",e)===0&&console.debug("Garbage: ",String.fromCharCode.apply(String,e),e)}_parse_and_consume_header(){this._trim_leading_garbage_until_header();var e=t.Header.parse(this._input_buffer);if(!!e)return t.DEBUG&&this._log_header("RECEIVED HEADER",e[0]),this._consume_header(e[0]),this._last_header_name=e[0].NAME,this._last_header_crc=e[1],e[0]}_log_header(e,r){console.debug(this.type,e,r.NAME,r._bytes4.join())}_consume_header(e){this._on_receive(e);var r=this._next_header_handler&&this._next_header_handler[e.NAME];if(!r)throw console.error("Unhandled header!",e,this._next_header_handler),new t.Error("Unhandled header: "+e.NAME);this._next_header_handler=null,r.call(this,e)}_check_for_abort_sequence(){var e=t.ZMLIB.find_subarray(this._input_buffer,u);if(e!==-1)throw this._input_buffer.splice(0,e+u.length),this._aborted=!0,this._on_session_end(),new t.Error("peer_aborted")}_send_header(e){if(!this._sender)throw"Need sender!";var r=Array.apply(null,arguments),a=this._create_header_bytes(r);t.DEBUG&&this._log_header("SENDING HEADER",a[1]),this._sender(a[0]),this._last_sent_header=a[1]}_create_header_bytes(e){var r=t.Header.build.apply(t.Header,e),a=this._get_header_formatter(e[0]);return[r[a](this._zencoder),r]}_strip_and_enqueue_input(e){t.ZMLIB.strip_ignored_bytes(e),this._input_buffer.push.apply(this._input_buffer,e)}abort(){this._sender(u.concat([s,s,s,s,s])),this._aborted=!0,this._sender=function(){throw new t.Error("already_aborted")},this._on_session_end()}_on_session_end(){this._Happen("session_end")}_on_receive(e){this._Happen("receive",e)}_before_consume(){}};function C(O){return t.ZMLIB.find_subarray(O,d)===0?O.splice(0,d.length):O[0]===d[d.length-1]&&O.splice(0,1),O}t.Session.Receive=class extends t.Session{constructor(){super(),this._Add_event("offer"),this._Add_event("data_in"),this._Add_event("file_end")}_before_consume(e){if(this._bytes_after_OO)throw"PROTOCOL: Session is completed!";this._bytes_being_consumed=e}get_trailing_bytes(){if(this._aborted)return[];if(!this._bytes_after_OO)throw"PROTOCOL: Session is not completed!";return this._bytes_after_OO.slice(0)}_has_ended(){return this.aborted()||!!this._bytes_after_OO}_get_header_formatter(){return"to_hex"}_parse_and_consume_subpacket(){var e;this._last_header_crc===16?e="parse16":e="parse32";var r=t.Subpacket[e](this._input_buffer);return r&&(t.DEBUG&&console.debug(this.type,"RECEIVED SUBPACKET",r),this._consume_data(r),r.frame_end()&&(this._next_subpacket_handler=null)),r}_consume_first(){if(this._got_ZFIN){if(this._input_buffer.length<2)return;this._bytes_after_OO=C(this._bytes_being_consumed.slice(0)),this._on_session_end();return}var e;do this._next_subpacket_handler?e=this._parse_and_consume_subpacket():e=this._parse_and_consume_header();while(e&&this._input_buffer.length)}_consume_data(e){if(this._on_receive(e),!this._next_subpacket_handler)throw"PROTOCOL: Received unexpected data packet after "+this._last_header_name+" header: "+e.get_payload().join();this._next_subpacket_handler.call(this,e)}_octets_to_string(e){return this._textdecoder||(this._textdecoder=new t.Text.Decoder),this._textdecoder.decode(new Uint8Array(e))}_consume_ZFILE_data(e,r){if(this._file_info)throw"PROTOCOL: second ZFILE data subpacket received";var a=r.get_payload(),y=a.indexOf(0),R=this._octets_to_string(a.slice(0,y)),M=this._octets_to_string(a.slice(1+y)).split(" "),D=M[1]&&parseInt(M[1],8)||void 0;D&&(D=new Date(D*1e3)),this._file_info={name:R,size:M[0]?parseInt(M[0],10):null,mtime:D||null,mode:M[2]&&parseInt(M[2],8)||null,serial:M[3]&&parseInt(M[3],10)||null,files_remaining:M[4]?parseInt(M[4],10):null,bytes_remaining:M[5]?parseInt(M[5],10):null};var f=new v(e.get_options(),this._file_info,this._accept.bind(this),this._skip.bind(this));this._current_transfer=f}_consume_ZDATA_data(e){if(!this._accepted_offer)throw"PROTOCOL: Received data without accepting!";if(!this._offset_ok){console.warn("offset not ok!"),_send_ZRPOS();return}this._file_offset+=e.get_payload().length,this._on_data_in(e),e.ack_expected()&&!e.frame_end()&&this._send_header("ZACK",t.ENCODELIB.pack_u32_le(this._file_offset))}_make_promise_for_between_files(){var e=this;return new Promise(function(r){var a={ZFILE:function(y){this._next_subpacket_handler=function(R){this._next_subpacket_handler=null,this._consume_ZFILE_data(y,R),this._Happen("offer",this._current_transfer),r(this._current_transfer)}},ZSINIT:function(y){e._next_subpacket_handler=function(R){e._next_subpacket_handler=null,e._consume_ZSINIT_data(R),e._send_header("ZACK"),e._next_header_handler=a}},ZFIN:function(){this._consume_ZFIN(),r()}};e._next_header_handler=a})}_consume_ZSINIT_data(e){this._attn=e.get_payload()}start(){if(this._started)throw"Already started!";this._started=!0;var e=this._make_promise_for_between_files();return this._send_ZRINIT(),e}_accept(e){this._accepted_offer=!0,this._file_offset=e||0;var r=this,a=new Promise(function(y){var R;r._next_header_handler={ZDATA:function(D){this._consume_ZDATA(D),this._next_subpacket_handler=this._consume_ZDATA_data,this._next_header_handler={ZEOF:function(P){this._consume_ZEOF(P),this._next_subpacket_handler=null,this._make_promise_for_between_files(),y(),this._send_ZRINIT()}}}}});return this._send_ZRPOS(),a}_skip(){var e=this._make_promise_for_between_files();if(this._accepted_offer){if(!this._current_transfer)return;var r=function(){this._accepted_offer=!1,this._next_subpacket_handler=null,this._make_promise_for_between_files()}.bind(this);Object.assign(this._next_header_handler,{ZEOF:r,ZDATA:function(){r(),this._next_header_handler.ZEOF=r}.bind(this)})}return this._file_info=null,this._send_header("ZSKIP"),e}_send_ZRINIT(){this._send_header("ZRINIT",c)}_consume_ZFIN(){this._got_ZFIN=!0,this._send_header("ZFIN")}_consume_ZEOF(e){if(this._file_offset!==e.get_offset())throw"ZEOF offset mismatch; unimplemented (local: "+this._file_offset+"; ZEOF: "+e.get_offset()+")";this._on_file_end(),this._file_info=null,this._current_transfer=null}_consume_ZDATA(e){if(this._file_offset===e.get_offset())this._offset_ok=!0;else throw"Error correction is unimplemented."}_send_ZRPOS(){this._send_header("ZRPOS",this._file_offset)}_on_file_end(){this._Happen("file_end"),this._current_transfer&&(this._current_transfer._Happen("complete"),this._current_transfer=null)}_on_data_in(e){this._Happen("data_in",e),this._current_transfer&&this._current_transfer._Happen("input",e.get_payload())}},Object.assign(t.Session.Receive.prototype,{type:"receive"});var b={get_details:function(){return Object.assign({},this._file_info)},get_options:function(){return Object.assign({},this._zfile_opts)},get_offset:function(){return this._file_offset}};class m{constructor(e,r,a,y){this._file_info=e,this._file_offset=r||0,this._send=a,this._end=y}send(e){this._send(e),this._file_offset+=e.length}end(e){var r=this._end(e||[]);return e&&(this._file_offset+=e.length),r}}Object.assign(m.prototype,b);class v extends x{constructor(e,r,a,y){super(),this._zfile_opts=e,this._file_info=r,this._accept_func=a,this._skip_func=y,this._Add_event("input"),this._Add_event("complete"),this.on("input",this._input_handler)}_verify_not_skipped(){if(this._skipped)throw new t.Error("Already skipped!")}skip(){return this._verify_not_skipped(),this._skipped=!0,this._skip_func.apply(this,arguments)}accept(e){if(this._verify_not_skipped(),this._accepted)throw new t.Error("Already accepted!");switch(this._accepted=!0,e||(e={}),this._file_offset=e.offset||0,e.on_input){case null:case void 0:case"spool_array":case i:this._spool=[];break;default:if(typeof e.on_input!="function")throw"Invalid \u201Con_input\u201D: "+e.on_input}return this._input_handler_mode=e.on_input||i,this._accept_func(this._file_offset).then(this._get_spool.bind(this))}_input_handler(e){if(this._file_offset+=e.length,typeof this._input_handler_mode=="function")this._input_handler_mode(e);else{if(this._input_handler_mode===i)e=new Uint8Array(e);else if(this._input_handler_mode!=="spool_array")throw new t.Error("WTF?? _input_handler_mode = "+this._input_handler_mode);this._spool.push(e)}}_get_spool(){return this._spool}}Object.assign(v.prototype,b);const g={ZFILE:!0,ZDATA:!0};t.Session.Send=class extends t.Session{constructor(e){if(super(),e){if(e.NAME!=="ZRINIT")throw"First header should be ZRINIT, not "+e.NAME}else throw"Need first header!";this._last_header_name="ZRINIT",this._subpacket_encode_func="encode16",this._zencoder=new t.ZDLE,this._consume_ZRINIT(e),this._file_offset=0;var r=0;this._start_keepalive_on_set_sender=!0}set_sender(e){return super.set_sender(e),this._start_keepalive_on_set_sender&&(this._start_keepalive_on_set_sender=!1,this._start_keepalive()),this}_get_header_formatter(e){return g[e]?"to_binary16":"to_hex"}_start_keepalive(){if(!this._keepalive_promise){var e=this;this._keepalive_promise=new Promise(function(r){e._keepalive_timeout=setTimeout(r,p)}).then(function(){e._next_header_handler={ZACK:function(){e._got_ZSINIT_ZACK=!0}},e._send_ZSINIT(),e._keepalive_promise=null,e._start_keepalive()})}}_stop_keepalive(){this._keepalive_promise&&(clearTimeout(this._keepalive_timeout),this._keep_alive_promise=null)}_send_ZSINIT(){var e=[];this._zencoder.escapes_ctrl_chars()&&e.push("ESCCTL"),this._send_header_and_data(["ZSINIT",e],[0],"end_ack")}_consume_ZRINIT(e){if(this._last_ZRINIT=e,e.get_buffer_size())throw"Buffer size ("+e.get_buffer_size()+") is unsupported!";if(!e.can_full_duplex())throw"Half-duplex I/O is unsupported!";if(!e.can_overlap_io())throw"Non-overlap I/O is unsupported!";if(e.escape_8th_bit())throw"8-bit escaping is unsupported!";l?(this._zencoder.set_escape_ctrl_chars(!0),e.escape_ctrl_chars()||console.debug("Peer didn\u2019t request escape of all control characters. Will send ZSINIT to force recognition of escaped control characters.")):this._zencoder.set_escape_ctrl_chars(e.escape_ctrl_chars())}_ensure_receiver_escapes_ctrl_chars(){var e,r=!this._last_ZRINIT.escape_ctrl_chars()&&!this._got_ZSINIT_ZACK;if(r){var a=this;e=new Promise(function(y){a._next_header_handler={ZACK:R=>{y()}},a._send_ZSINIT()})}else e=Promise.resolve();return e}_convert_params_to_offer_payload_array(e){e=t.Validation.offer_parameters(e);var r=e.name+"\0",a=[(e.size||0).toString(10),e.mtime?e.mtime.toString(8):"0",e.mode?(32768|e.mode).toString(8):"0","0"];return e.files_remaining&&(a.push(e.files_remaining),e.bytes_remaining&&a.push(e.bytes_remaining)),r+=a.join(" "),this._string_to_octets(r)}send_offer(e){if(t.DEBUG&&console.debug("SENDING OFFER",e),!e)throw"need file params!";if(this._sending_file)throw"Already sending file!";var r=this._convert_params_to_offer_payload_array(e);this._stop_keepalive();var a=this;function y(){a._next_header_handler={ZRPOS:function(M){t.DEBUG&&console.warn("Mid-transfer ZRPOS \u2026 implementation error?"),y()}}}var R=function(){var M=new Promise(function(D){a._next_header_handler={ZSKIP:function(){a._start_keepalive(),D()},ZRPOS:function(f){a._sending_file=!0,y(),D(new m(e,f.get_offset(),a._send_interim_file_piece.bind(a),a._end_file.bind(a)))}}});return a._send_header_and_data(["ZFILE"],r,"end_ack"),delete a._sent_ZDATA,M};return l?this._ensure_receiver_escapes_ctrl_chars().then(R):R()}_send_header_and_data(e,r,a){var y=this._create_header_bytes(e),R=this._build_subpacket_bytes(r,a);y[0].push.apply(y[0],R),t.DEBUG&&(this._log_header("SENDING HEADER",y[1]),console.debug(this.type,"-- HEADER PAYLOAD:",a,R.length)),this._sender(y[0]),this._last_sent_header=y[1]}_build_subpacket_bytes(e,r){var a=t.Subpacket.build(e,r);return a[this._subpacket_encode_func](this._zencoder)}_build_and_send_subpacket(e,r){this._sender(this._build_subpacket_bytes(e,r))}_string_to_octets(e){this._textencoder||(this._textencoder=new t.Text.Encoder);var r=this._textencoder.encode(e);return Array.prototype.slice.call(r)}_send_interim_file_piece(e){return this._send_file_part(e,"no_end_no_ack"),Promise.resolve()}_ensure_we_are_sending(){if(!this._sending_file)throw"Not sending a file currently!"}_end_file(e){this._ensure_we_are_sending(),this._send_file_part(e,"end_no_ack");var r=this,a=new Promise(function(y){r._sending_file=!1,r._prepare_to_receive_ZRINIT(y)});return this._send_header("ZEOF",this._file_offset),this._file_offset=0,a}_prepare_to_receive_ZRINIT(e){this._next_header_handler={ZRINIT:function(r){this._consume_ZRINIT(r),e&&e()}}}close(){var e=this._last_header_name==="ZRINIT";if(e||(e=this._last_header_name==="ZSKIP"),e||(e=this._last_sent_header.name==="ZSINIT"&&this._last_header_name==="ZACK"),!e)throw"Can\u2019t close; last received header was \u201C"+this._last_header_name+"\u201D";var r=this,a=new Promise(function(y,R){r._next_header_handler={ZFIN:function(){r._sender(d),r._sent_OO=!0,r._on_session_end(),y()}}});return this._send_header("ZFIN"),a}_has_ended(){return this.aborted()||!!this._sent_OO}_send_file_part(e,r){this._sent_ZDATA||(this._send_header("ZDATA",this._file_offset),this._sent_ZDATA=!0);for(var a=0,y=e.length;;){var R=Math.min(a+n,y)-a,M=R+a>=y,D=e.slice(a,a+R);if(D instanceof Array||(D=Array.prototype.slice.call(D)),this._build_and_send_subpacket(D,M?r:"no_end_no_ack"),this._file_offset+=R,a+=R,a>=y)break}}_consume_first(){if(!this._parse_and_consume_header()&&this._input_buffer.join()==="67")throw"Receiver has fallen back to YMODEM."}_on_session_end(){this._stop_keepalive(),super._on_session_end()}},Object.assign(t.Session.Send.prototype,{type:"send"})},82746:(w,k,o)=>{"use strict";var t=w.exports;Object.assign(t,o(46705),o(48179),o(97510),o(50903));const p=104,c=105,l=106,i=107;var n;t.Subpacket=class ue{static build(v,g){var O=n[g];if(!O)throw"No subpacket type \u201C"+g+"\u201D is defined! Try one of: "+Object.keys(n).join(", ");return new O(v)}encode16(v){return this._encode(v,t.CRC.crc16)}encode32(v){return this._encode(v,t.CRC.crc32)}get_payload(){return this._payload}static parse16(v){return ue._parse(v,2)}static parse32(v){return ue._parse(v,4)}constructor(v){this._payload=v}_encode(v,g){return v.encode(this._payload.slice(0)).concat([t.ZMLIB.ZDLE,this._frameend_num],v.encode(g(this._payload.concat(this._frameend_num))))}static _parse(v,g){for(var O,e,r={104:u,105:C,106:b,107:x},a=0;a<v.length;){if(a=v.indexOf(t.ZMLIB.ZDLE,a),a===-1)return;var y=v[a+1];if(e=r[y],e){O=a+1;break}a++}if(!!e){var R=v[O];if(v[O-1]!==t.ZMLIB.ZDLE)throw"Byte before frame end should be ZDLE, not "+v[O-1];var M=v.splice(0,O-1),D=t.ZDLE.splice(v,2,g);if(!D){v.unshift.apply(v,M);return}var f=t.ZDLE.decode(M);return t.CRC[g===2?"verify16":"verify32"](f.concat([R]),D),new e(f,D)}}};class s extends t.Subpacket{frame_end(){return!0}}class d extends t.Subpacket{frame_end(){return!1}}class u extends s{ack_expected(){return!1}}u.prototype._frameend_num=p;class x extends s{ack_expected(){return!0}}x.prototype._frameend_num=i;class C extends d{ack_expected(){return!1}}C.prototype._frameend_num=c;class b extends d{ack_expected(){return!0}}b.prototype._frameend_num=l,n={end_no_ack:u,end_ack:x,no_end_no_ack:C,no_end_ack:b}},33206:(w,k,o)=>{"use strict";var t=w.exports;Object.assign(t,o(50903));const p=/\*\x18[AC]|\*\*\x18B/;function c(l,i){if(i<0)throw new t.Error("validation","\u201C"+l+"\u201D ("+i+") must be nonnegative.");if(i!==Math.floor(i))throw new t.Error("validation","\u201C"+l+"\u201D ("+i+") must be an integer.")}t.Validation={offer_parameters:function(i){if(!i.name)throw new t.Error("validation","Need \u201Cname\u201D!");if(typeof i.name!="string")throw new t.Error("validation","\u201Cname\u201D ("+i.name+") must be a string!");if(i=Object.assign({},i),p.test(i.name)&&console.warn("The filename "+JSON.stringify(name)+" contains characters that look like a ZMODEM header. This could corrupt the ZMODEM session; consider renaming it so that the filename doesn\u2019t contain control characters."),i.serial!==null&&i.serial!==void 0)throw new t.Error("validation","\u201Cserial\u201D is meaningless.");if(i.serial=null,["size","mode","files_remaining","bytes_remaining"].forEach(function(d){var u;switch(typeof i[d]){case"object":u=i[d]===null;break;case"undefined":i[d]=null,u=!0;break;case"number":c(d,i[d]),u=!0;break}if(!u)throw new t.Error("validation","\u201C"+d+"\u201D ("+i[d]+") must be null, undefined, or a number.")}),typeof i.mode=="number"&&(i.mode|=32768),i.files_remaining===0)throw new t.Error("validation","\u201Cfiles_remaining\u201D, if given, must be positive.");var n;switch(typeof i.mtime){case"object":if(n=!0,i.mtime instanceof Date){var s=i.mtime;if(i.mtime=Math.floor(s.getTime()/1e3),i.mtime<0)throw new t.Error("validation","\u201Cmtime\u201D ("+s+") must not be earlier than 1970.")}else i.mtime!==null&&(n=!1);break;case"undefined":i.mtime=null,n=!0;break;case"number":c("mtime",i.mtime),n=!0;break}if(!n)throw new t.Error("validation","\u201Cmtime\u201D ("+i.mtime+") must be null, undefined, a Date, or a number.");return i}}},72653:w=>{w.exports=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]]},71011:(w,k,o)=>{"use strict";var t=o(34575),p=o(72653),c={nul:0,control:0};w.exports=function(d){return l(d,c)},w.exports.config=function(s){return s=t(s||{},c),function(u){return l(u,s)}};function l(s,d){if(typeof s!="string")return i(s,d);for(var u=0,x=0;x<s.length;x++){var C=i(s.charCodeAt(x),d);if(C<0)return-1;u+=C}return u}function i(s,d){return s===0?d.nul:s<32||s>=127&&s<160?d.control:n(s)?0:1+(s>=4352&&(s<=4447||s==9001||s==9002||s>=11904&&s<=42191&&s!=12351||s>=44032&&s<=55203||s>=63744&&s<=64255||s>=65040&&s<=65049||s>=65072&&s<=65135||s>=65280&&s<=65376||s>=65504&&s<=65510||s>=131072&&s<=196605||s>=196608&&s<=262141))}function n(s){var d=0,u=p.length-1,x;if(s<p[0][0]||s>p[u][1])return!1;for(;u>=d;)if(x=Math.floor((d+u)/2),s>p[x][1])d=x+1;else if(s<p[x][0])u=x-1;else return!0;return!1}}}]);
