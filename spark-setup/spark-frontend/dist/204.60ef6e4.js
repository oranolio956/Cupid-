(self.webpackChunkspark=self.webpackChunkspark||[]).push([[204,678,804,873],{34383:(B,T,e)=>{"use strict";e.d(T,{A:()=>C});var t=e(31601),u=e.n(t),m=e(76314),c=e.n(m),P=c()(u());P.push([B.id,`a{user-select:none}.ant-table-body{max-height:300px;min-height:300px}.ant-breadcrumb{overflow-x:hidden;white-space:nowrap}.ant-pro-table-list-toolbar{overflow:hidden;-ms-overflow-style:none;scrollbar-width:none}.ant-pro-table-list-toolbar::-webkit-scrollbar{display:none}.editor-modal,.editor-modal>.ant-modal-content{top:0;margin:0;padding:0;height:100%;width:100%!important;max-width:100%!important}.editor-modal>.ant-modal-content>.ant-modal-body{height:calc(100% - 110px)}.file-row{user-select:none;cursor:pointer}
`,""]);const C=P},37848:(B,T,e)=>{"use strict";e.d(T,{default:()=>X});var t=e(68275),u=e(96540),m=e(55794),c=e.n(m),P=Object.defineProperty,C=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,W=(l,d,_)=>d in l?P(l,d,{enumerable:!0,configurable:!0,writable:!0,value:_}):l[d]=_,R=(l,d)=>{for(var _ in d||(d={}))g.call(d,_)&&W(l,_,d[_]);if(C)for(var _ of C(d))x.call(d,_)&&W(l,_,d[_]);return l};function A(l){const[d,_]=(0,u.useState)(!0),[O,j]=(0,u.useState)({left:0,top:0,bottom:0,right:0}),I=(0,u.useRef)(null),F=(K,y)=>{var L;const{clientWidth:G,clientHeight:N}=window.document.documentElement,U=(L=I.current)==null?void 0:L.getBoundingClientRect();!U||d||j({left:-U.left+y.x,right:G-(U.right-y.x),top:-U.top+y.y,bottom:N-(U.bottom-y.y)})};return u.createElement(t.A,R({title:u.createElement("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{d&&l.draggable&&_(!1)},onMouseOut:()=>{_(!0)},onFocus:()=>{},onBlur:()=>{_(!0)}},l.modalTitle),modalRender:K=>u.createElement(c(),{disabled:d||!l.draggable,bounds:O,onStart:(y,L)=>F(y,L)},u.createElement("div",{ref:I},K))},l),l.children)}const X=A},43678:(B,T,e)=>{"use strict";e.d(T,{default:()=>O});var t=e(85072),u=e.n(t),m=e(97825),c=e.n(m),P=e(77659),C=e.n(P),g=e(55056),x=e.n(g),W=e(10540),R=e.n(W),A=e(41113),X=e.n(A),l=e(34383),d={};d.styleTagTransform=X(),d.setAttributes=x(),d.insert=C().bind(null,"head"),d.domAPI=c(),d.insertStyleElement=R();var _=u()(l.A,d);const O=l.A&&l.A.locals?l.A.locals:void 0},54055:(B,T,e)=>{"use strict";e.d(T,{default:()=>_});var t=e(96540),u=e(55373),m=e.n(u),c=e(75427),P=e(72505),C=e.n(P),g=e(79478),x=e(68275),W=e(57427),R=e(26493),A=e(47730),X=e(37848);let l=null;function d(O){const[j,I]=(0,t.useState)(!!O.file),[F,K]=(0,t.useState)(0),[y,L]=(0,t.useState)(0);(0,t.useEffect)(()=>{L(0),O.file&&(I(!0),K(0))},[O.file]);function G(){if(y!==0){N();return}const te=m().stringify({device:O.device.id,path:O.path,file:O.file.name});let b=1;L(1),window.onbeforeunload=c.V3,l=new AbortController,C().post("/api/device/file/upload?"+te,O.file,{headers:{"Content-Type":"application/octet-stream"},timeout:0,onUploadProgress:S=>{let k=Math.round(S.loaded*100/S.total);K(k)},signal:l.signal}).then(S=>{S.data.code===0?(b=2,L(2),g.Ay.success(A.Ay.t("EXPLORER.UPLOAD_SUCCESS"))):(b=3,L(3))}).catch(S=>{C().isCancel(S)?(b=4,L(4),g.Ay.error(A.Ay.t("EXPLORER.UPLOAD_ABORTED"))):(b=3,L(3),g.Ay.error(A.Ay.t("EXPLORER.UPLOAD_FAILED")+A.Ay.t("COMMON.COLON")+S.message))}).finally(()=>{l=null,window.onbeforeunload=null,setTimeout(()=>{I(!1),b===2?O.onSuccess():O.onCancel()},1500)})}function N(){if(y===0){I(!1),setTimeout(O.onCancel,300);return}if(y===1){x.A.confirm({autoFocusButton:"cancel",content:A.Ay.t("EXPLORER.UPLOAD_CANCEL_CONFIRM"),onOk:()=>{l.abort()},okButtonProps:{danger:!0}});return}setTimeout(()=>{I(!1),setTimeout(O.onCancel,300)},1500)}function U(){switch(y){case 1:return F+"%";case 2:return A.Ay.t("EXPLORER.UPLOAD_SUCCESS");case 3:return A.Ay.t("EXPLORER.UPLOAD_FAILED");case 4:return A.Ay.t("EXPLORER.UPLOAD_ABORTED");default:return A.Ay.t("EXPLORER.UPLOAD")}}return t.createElement(X.default,{centered:!0,draggable:!0,open:j,closable:!1,keyboard:!1,maskClosable:!1,destroyOnClose:!0,confirmLoading:y===1,okText:A.Ay.t(y===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),modalTitle:A.Ay.t(y===1?"EXPLORER.UPLOADING":"EXPLORER.UPLOAD"),okButtonProps:{disabled:y!==0},cancelButtonProps:{disabled:y>1},onCancel:N,onOk:G,width:550},t.createElement("div",null,t.createElement("span",{style:{whiteSpace:"nowrap",fontSize:"20px",marginRight:"10px"}},U()),t.createElement(R.A.Text,{ellipsis:{rows:1},style:{maxWidth:"calc(100% - 140px)"}},O.file.name),t.createElement("span",{style:{whiteSpace:"nowrap"}},"\uFF08"+(0,c.Xq)(O.file.size)+"\uFF09")),t.createElement(W.A,{strokeLinecap:"butt",percent:F,showInfo:!1}))}const _=d},71508:B=>{function T(t){var u,m,c="";if(typeof t=="string"||typeof t=="number")c+=t;else if(typeof t=="object")if(Array.isArray(t)){var P=t.length;for(u=0;u<P;u++)t[u]&&(m=T(t[u]))&&(c&&(c+=" "),c+=m)}else for(m in t)t[m]&&(c&&(c+=" "),c+=m);return c}function e(){for(var t,u,m=0,c="",P=arguments.length;m<P;m++)(t=arguments[m])&&(u=T(t))&&(c&&(c+=" "),c+=u);return c}B.exports=e,B.exports.clsx=e},80503:(B,T,e)=>{"use strict";e.d(T,{default:()=>he});var t=e(96540),u=e(25955),m=e(70881),c=e(40570),P=e(21086),C=e(68275),g=e(79478),x=e(50400),W=e(86348),R=e(75427),A=e(74353),X=e.n(A),l=e(47730),d=e(31331),_=e(21348),O=e(80581),j=e(89379),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};const F=I;var K=e(59114),y=function(a,s){return t.createElement(K.A,(0,j.A)((0,j.A)({},a),{},{ref:s,icon:F}))},L=t.forwardRef(y);const G=L;var N=e(55373),U=e.n(N),te=e(37848),b=e(54055),S=e(80952),k=e.n(S),be=e(43678),me=Object.defineProperty,ae=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,oe=(r,a,s)=>a in r?me(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s,ye=(r,a)=>{for(var s in a||(a={}))_e.call(a,s)&&oe(r,s,a[s]);if(ae)for(var s of ae(a))Oe.call(a,s)&&oe(r,s,a[s]);return r},Ae=(r,a,s)=>new Promise((p,h)=>{var f=D=>{try{Q(s.next(D))}catch(V){h(V)}},v=D=>{try{Q(s.throw(D))}catch(V){h(V)}},Q=D=>D.done?p(D.value):Promise.resolve(D.value).then(f,v);Q((s=s.apply(r,a)).next())});let q=null;const Re=k().require("ace/ext/modelist");function Pe(r){q===null?Promise.all([e.e(470),e.e(438),e.e(95),e.e(719)]).then(e.bind(e,79100)).then(a=>{q=a.default,r()}):r()}let M=!1,w="",z=[];function ve(r){const[a,s]=(0,t.useState)("/"),[p,h]=(0,t.useState)(""),[f,v]=(0,t.useState)(!1),[Q,D]=(0,t.useState)(!0),[V,ee]=(0,t.useState)(!1),[se,re]=(0,t.useState)(""),[ge,ie]=(0,t.useState)(""),[Z,de]=(0,t.useState)([]),Le=[{key:"Name",title:l.Ay.t("EXPLORER.FILE_NAME"),dataIndex:"name",ellipsis:!0,width:180},{key:"Size",title:l.Ay.t("EXPLORER.FILE_SIZE"),dataIndex:"size",ellipsis:!0,width:60,renderText:(n,o)=>o.type===0||o.type===2?(0,R.Xq)(n):"-"},{key:"Time",title:l.Ay.t("EXPLORER.DATE_MODIFIED"),dataIndex:"time",ellipsis:!0,width:100,renderText:(n,o)=>o.type===0?X().unix(n).format(l.Ay.t("EXPLORER.DATE_TIME_FORMAT")):"-"},{key:"Option",width:120,title:"",dataIndex:"name",valueType:"option",ellipsis:!0,render:(n,o)=>pe(o)}],De={show:!0,search:!0,reload:!1,density:!1,setting:!1},H=(0,t.useRef)(),Te=(0,t.useMemo)(()=>(0,d.x)({height:300,vid:"file-table"}),[]),Ce=()=>t.createElement(c.A,{size:16},t.createElement(P.A,{title:l.Ay.t("EXPLORER.DOWNLOAD_MULTI_CONFIRM"),onConfirm:()=>le(Z)},t.createElement("a",null,l.Ay.t("EXPLORER.DOWNLOAD"))),t.createElement(P.A,{title:l.Ay.t("EXPLORER.DELETE_MULTI_CONFIRM"),onConfirm:()=>Ee(Z)},t.createElement("a",null,l.Ay.t("EXPLORER.DELETE"))));(0,t.useEffect)(()=>{r.device&&(M=r.device.os==="windows",w="/",s("/")),r.open&&(z=[],v(!1))},[r.device,r.open]);function pe(n){let o=[{key:"editAsText",name:l.Ay.t("EXPLORER.EDIT_AS_TEXT")},{key:"delete",name:l.Ay.t("EXPLORER.DELETE")}];if(n.type===1)o.shift();else if(n.type===2)return[];return n.name===".."?[]:[t.createElement("a",{key:"download",onClick:()=>le(n.name)},l.Ay.t("EXPLORER.DOWNLOAD")),t.createElement(u.A,{key:"more",onSelect:i=>Me(i,n),menus:o})]}function Me(n,o){switch(n){case"delete":let i=l.Ay.t("EXPLORER.DELETE_CONFIRM");o.type===0?i=i.replace("{0}",l.Ay.t("EXPLORER.FILE")):i=i.replace("{0}",l.Ay.t("EXPLORER.FOLDER")),C.A.confirm({icon:t.createElement(_.A,null),content:i,onOk:Ee.bind(null,o.name)});break;case"editAsText":ue(o)}}function Ie(n){const o=M?"\\":"/";if(n.name===".."){ne(ce(w));return}if(n.type!==0){if(M&&(a==="/"||a==="\\"||a.length===0)){ne(n.name+o);return}ne(a+n.name+o);return}const i=n.name.split(".").pop().toLowerCase();if(["jpg","jpeg","png","gif","bmp"].includes(i)&&n.size<=2<<22){Ue(n);return}if(n.size<=2<<20){const J=Re.getModeForPath(n.name);if(J&&J.extRe.test(n.name)){ue(n);return}}le(n.name)}function Ue(n){v(!0),(0,R.Em)("/api/device/file/get",{device:r.device.id,files:a+n.name},{},{responseType:"blob",timeout:1e4}).then(o=>{o.status===200&&(p.length>0&&URL.revokeObjectURL(p),h(URL.createObjectURL(o.data)))}).catch(R.bv).finally(()=>{v(!1)})}function ue(n){if(n.size>2<<20){g.Ay.warn(l.Ay.t("EXPLORER.FILE_TOO_LARGE"));return}se||(v(!0),(0,R.Em)("/api/device/file/text",{device:r.device.id,file:a+n.name},{},{responseType:"blob",timeout:7e3}).then(o=>{o.status===200&&o.data.text().then(i=>{Pe(()=>{ie(i),D(!1),re(n.name)})})}).catch(R.bv).finally(()=>{v(!1)}))}function ne(n){f||(w=n,s(n),H.current.reload())}function ce(n){let o=M?"\\":"/",E=n.substring(0,n.length-1).split(o);return E.pop(),E.length===0?"/":E.join(o)+o}function Se(){if((a==="/"||a==="\\"||a.length===0)&&M){g.Ay.error(l.Ay.t("EXPLORER.UPLOAD_INVALID_PATH"));return}document.getElementById("file-uploader").click()}function Be(n){let o=n.target.files[0];if(o!==void 0){n.target.value=null;{let i=!1;for(let E=0;E<z.length;E++)if(z[E].type===0&&z[E].name===o.name){i=!0;break}i?C.A.confirm({autoFocusButton:"cancel",content:l.Ay.t("EXPLORER.OVERWRITE_CONFIRM").replace("{0}",o.name),okText:l.Ay.t("EXPLORER.OVERWRITE"),onOk:()=>{ee(o)},okButtonProps:{danger:!0}}):(ee(o),D(!1))}}}function xe(){H.current.reload(),ee(!1),D(!0)}function We(){ee(!1),D(!0)}function le(n){if((a==="/"||a==="\\"||a.length===0)&&M){g.Ay.error(l.Ay.t("EXPLORER.DOWNLOAD_VOLUMES_ERROR"));return}let o=[];if(Array.isArray(n))for(let i=0;i<n.length;i++)n[i]!==".."&&o.push(a+n[i]);else o=a+n;(0,R.bE)(location.origin+location.pathname+"api/device/file/get",{files:o,device:r.device.id})}function Ee(n){if((a==="/"||a==="\\"||a.length===0)&&M){g.Ay.error(l.Ay.t("EXPLORER.DELETE_INVALID_PATH"));return}let o=[];if(Array.isArray(n))for(let i=0;i<n.length;i++)n[i]!==".."&&o.push(a+n[i]);else o=a+n;(0,R.Em)("/api/device/file/remove",{files:o,device:r.device.id},{},{transformRequest:[i=>U().stringify(i,{indices:!1})]}).then(i=>{i.data.code===0&&(g.Ay.success(l.Ay.t("EXPLORER.DELETE_SUCCESS")),H.current.reload())})}function Xe(n){return Ae(this,null,function*(){var o;yield(0,R.zR)(300);let i=yield(0,R.Em)("/api/device/file/list",{path:w,device:r.device.id});de([]),v(!1);let E=i.data;if(E.code===0){let J=!1;if(n.keyword=(o=n.keyword)!=null?o:"",n.keyword.length>0){let $=n.keyword.toLowerCase(),Y=$.replace(/[.+^${}()|[\]\\]/g,"\\$&"),Ke=new RegExp(`^${Y.replace(/\*/g,".*").replace(/\?/g,".")}$`,"i");E.data.files=E.data.files.filter(fe=>fe.name.toLowerCase().includes($)?!0:Ke.test(fe.name))}return E.data.files=E.data.files.sort(($,Y)=>(0,R.u1)($.name,Y.name)),E.data.files=E.data.files.sort(($,Y)=>Y.type-$.type),a.length>0&&a!=="/"&&a!=="\\"&&(J=!0,E.data.files.unshift({name:"..",size:"0",type:3,modTime:0})),z=[].concat(E.data.files),s(w),{data:E.data.files,success:!0,total:E.data.files.length-(J?1:0)}}return s(ce(w)),{data:[],success:!1,total:0}})}return t.createElement(te.default,ye({draggable:Q,maskClosable:!1,destroyOnClose:!0,modalTitle:l.Ay.t("EXPLORER.TITLE"),footer:null,width:830,bodyStyle:{padding:0}},r),t.createElement(m.Ay,{rowKey:"name",tableStyle:{minHeight:"320px",maxHeight:"320px"},onRow:n=>({onDoubleClick:Ie.bind(null,n)}),scroll:{scrollToFirstRowOnChange:!0,y:300},search:!1,size:"small",loading:f,rowClassName:"file-row",onLoadingChange:v,rowSelection:{selectedRowKeys:Z,onChange:de,alwaysShowAlert:!0},tableAlertRender:()=>l.Ay.t("EXPLORER.MULTI_SELECT_LABEL").replace("{0}",String(Z.length)).replace("{1}",String(z.length)),tableAlertOptionRender:Z.length===0?null:Ce,options:De,columns:Le,request:Xe,pagination:!1,actionRef:H,components:Te}),t.createElement(x.A,{style:{right:"59px"},className:"header-button",icon:t.createElement(O.A,null),onClick:()=>{H.current.reload()}}),t.createElement(x.A,{style:{right:"115px"},className:"header-button",icon:t.createElement(G,null),onClick:Se}),t.createElement("input",{id:"file-uploader",type:"file",onChange:Be,style:{display:"none"}}),q&&t.createElement(q,{path:a,file:se,device:r.device,content:ge,onCancel:n=>{re(""),ie(""),D(!0),n&&H.current.reload()}}),t.createElement(b.default,{open:V,path:a,file:V,device:r.device,onSuccess:xe,onCancel:We}),t.createElement(W.A,{preview:{visible:p,src:p,onVisibleChange:()=>{URL.revokeObjectURL(p),h("")}}}))}function je(r){let a=M?"\\":"/",s=[],p=[],h=r.path;h.endsWith(a)&&(h=h.substring(0,h.length-1)),h.length>0&&h!=="/"&&h!=="\\"&&(s=h.split(a));for(let f=0;f<s.length;f++){let v=s[f];f===0&&M&&v.endsWith(":")&&(v=v.substring(0,v.length-1)),p.push({name:v,path:s.slice(0,f+1).join(a)+a})}if(s.length>0&&M){let f=s[0];f.endsWith(":")&&(f=f.substring(0,f.length-1)),s[0]=f}return p.pop(),React.createElement(Breadcrumb,{style:{marginLeft:"10px",marginRight:"10px"},disabled:r.loading},React.createElement(Breadcrumb.Item,{style:{cursor:"pointer"},onClick:r.onClick.bind(null,"/")},React.createElement(HomeOutlined,null)),p.map(f=>React.createElement(Breadcrumb.Item,{key:f.path,style:{cursor:"pointer"},onClick:r.onClick.bind(null,f.path)},f.name)),s.length>0?React.createElement(Breadcrumb.Item,null,s[s.length-1]):null)}const he=ve}}]);
